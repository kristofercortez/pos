{% extends "GistTemplateBundle::base.html.twig" %}
{% import "GistTemplateBundle::form.html.twig" as form %}

{% block content %}
<div class="page-content">
	<form method="post" class="form-horizontal">
		<div class="row" style="width: 100%;">
			<div class="col-md-1"></div>
        <div class="col-md-10">
        	<h2 class="form-section">Details for Transaction {{object.getTransDisplayId|default('')}}</h2>
				<br>

                <div class="portlet-body form">
                    <!-- BEGIN FORM-->
                    <form method="post" class="form-horizontal">
                        <div class="form-body">
                            <h4 class="form-section">Information</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    {{ form.group_text('Receipt Number', 'trans_code', object.getTransDisplayId|default(''), 4, 5, true) }}
                                    {{ form.group_text('Customer', 'customer', object.getCustomerId|default(''), 4, 5, true) }}
                                    {{ form.group_text('Type', 'trans_type', object.getTransactionTypeFormatted|default(''), 4, 5, true) }}
                                    {{ form.group_text('Bulk Discount', 'bulk_discount', object.getBulkDiscountType|default(''), 4, 5, true) }}
                                </div>
                                <div class="col-md-6">
                                    {{ form.group_text('Mode', 'mode', object.getTransactionModeFormatted|default(''), 4, 5, true) }}
                                    {{ form.group_text('Total', 'total', object.getCartOrigTotal|number_format(2, '.', ',')|default(''), 4, 5, true) }}
                                    {{ form.group_text('Discounted Total', 'discounted_total', object.getTransactionTotal|number_format(2, '.', ',')|default(''), 4, 5, true) }}
                                    {{ form.group_text('Balance', 'Balance', object.getTransactionBalance|number_format(2, '.', ',')|default(''), 4, 5, true) }}
                                </div>
                            </div>                           
                            <h4 class="form-section">Items</h4>
                            <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="list_table">
                                <thead>
                                    <tr>
                                        <th width="40%">Item Name</th>
                                        <th width="10%">SRP</th>
                                        <th width="10%">Discount Type</th>
                                        <th width="10%">Discount Value</th>
                                        <th width="10%">Adjusted Price</th>
                                    </tr>
                                </thead>
                                <tbody id="items_given_tbody">
                                	{% if object.hasParent %}
										{% for i in object.getReferenceTransaction.getItems|default('') %}
											<tr>
		                                        <td><input type="text" name="rate_name[]" value="{{i.getName|default('')}}" class="form-control rate_name" readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getOrigPrice|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" name="x" class="form-control" value="{{i.getDiscountTypeFormatted2|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getDiscountValue|number_format(0, '.', ',')|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getAdjustedPrice|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
	                                      	</tr>
										{% endfor %}
									{% else %}
	                                    {% for i in object.getItems|default('') %}
	                                      	<tr>
		                                        <td><input type="text" name="rate_name[]" value="{{i.getName|default('')}}" class="form-control rate_name" readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getOrigPrice|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" name="x" class="form-control" value="{{i.getDiscountType|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getDiscountValue|number_format(0, '.', ',')|default('')}}"  readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getAdjustedPrice|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
	                                      	</tr>
	                                    {% endfor %}
	                                 {% endif %}
                                </tbody>
                            </table>
                            <h4 class="form-section">Payments</h4>
                            <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="list_table">
                                <thead>
                                    <tr>
                                        <th width="20%">Type</th>
                                        <th width="20%">Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="items_given_tbody">
                                	{% if object.hasParent %}
	                                    {% for i in object.getReferenceTransaction.getPayments|default('') %}
	                                      	<tr>
		                                        <td><input type="text" name="rate_name[]" value="{{i.getType|default('')}}" class="form-control rate_name" readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getAmount|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
	                                      	</tr>
	                                    {% endfor %}
	                                {% else %}
	                                	{% for i in object.getPayments|default('') %}
	                                      	<tr>
		                                        <td><input type="text" name="rate_name[]" value="{{i.getType|default('')}}" class="form-control rate_name" readonly="true"></td>
		                                        <td><input type="text" style="text-align: right !important;" name="x" class="form-control qty" value="{{i.getAmount|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
	                                      	</tr>
	                                    {% endfor %}
	                                {% endif %}
                                    <tr>
                                    <td colspan="2"><b class="pull-right">Total Payments</b><input type="text" name="x" class="form-control qty" style="text-align: right !important;" value="{{object.getTotalPayments|number_format(2, '.', ',')|default('')}}"  readonly="true"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="form-actions fluid">
                            <div class="col-md-9">
                            	{% if object.getTransactionMode == 'quotation' and not object.hasChild %}
								<a href="{{ path('gist_pos_quote_to_sale', { 'id': object.getID }) }}" class="btn default btn blue"><i class="fa fa-arrow-circle-right"></i> Proceed to Sale</a>
								{% endif %}
                                {% if object.getTransactionMode == 'frozen' %}
                                <a href="javascript:void(0)" class="btn default btn blue"><i class="fa fa-shopping-cart"></i> Continue transaction</a>
                                {% endif %}
                                {% if (object.getExtraAmount != '0' and object.getExtraAmount != '') and object.getTransactionMode == 'normal' %}
                                <a href="javascript:void(0)" class="btn default green"><i class="fa fa-chevron-circle-up"></i> Upsell</a>
                                {% endif %}
                                <a href="{{ path('gist_pos_reports') }}" class="btn default">Go Back</a>
                            </div>
                        </div>
                    </form>
                    <!-- END FORM-->
            
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>
</form>
</div>
{% endblock %}

{% block js %}
    <script>
        $(document).ready(function() {
            var discount = "{{object.getTransactionTypeFormatted|default('')}}";
            $('#cgroup-bulk_discount').hide();
            $('#cgroup-discounted_total').hide();
            if (discount == "Bulk Discount") {
                $('#cgroup-bulk_discount').show();
                $('#cgroup-discounted_total').show();
            } else if(discount == 'Per-item Discount') {
                $('#cgroup-discounted_total').show();
            }
        });
    </script>
{% endblock %}
