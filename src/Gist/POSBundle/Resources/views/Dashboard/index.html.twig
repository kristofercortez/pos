{% extends "GistTemplateBundle::base.html.twig" %}
{% import "GistTemplateBundle::form.html.twig" as form_tools %}
{% block content %}
<div class="page-content">
    <div class="row">
        <div class="col-md-12">
        <!-- START -->
        <br>
    <div class="row">
        <div class="col-md-2">
        	<div class="portlet box blue-hoki" style="background-color: #2D2D2D;">
                <div class="portlet-title">
                    <div class="caption">Product Categories</div>
                </div>
                <div class="portlet-body form" id="prod_cats" style="background-color: #2D2D2D;">
                	<br>
                    <button class="btn btn-lg btn-block" style="background-color: #556E93; color: #ffffff;">...</button>
                </div>
            </div>
        </div>
        <div class="col-md-7">
        	<div class="portlet box blue-hoki">
                <div class="portlet-title">
                    <div class="caption">Products</div>
                </div>
                <div class="portlet-body form">
                	<br>
                	<div class="row" id="prods">
                		
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
        	<div class="portlet box blue-hoki" style="background-color: #ffffff;">
                <div class="portlet-title">
                    <div class="caption">Cart</div>
                </div>
                <div class="portlet-body form">
                <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="list_table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Price</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="cart_items">

                    </tbody>
                </table>
                <h3>Total: Php <span id="cart_price" value="0">0</span></h3>
                    
                </div>
            </div>
        </div>
    </div>
        <!-- END -->
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
function addToCart(product_name, srp)
{
    var total = parseInt($("#cart_price").text());
    total = total + parseInt(srp);
    var field = '<tr>';     
        // field += '<input type="hidden" name="item_id[]" value="'+item_id+'">';
        field += '<td><input type="text" value="'+product_name+'" readonly="true" class="form-control item_name"></td>';
        field += '<td><input type="number" name="qty" class="form-control qty" min="1" value="'+srp+'"></td>';     
        field += '<td><a href="javascript:void(0)" class="btn btn-xs default red remove_row">Remove</a></td>'; 
        field += '</tr>';
        $("#cart_price").val(total);
        $("#cart_price").text(total.toString());
        $('#cart_items').append(field);
}
function ajaxGetProductCategories()
{
    $( "#prod_cats" ).empty();

    var url = "http://erp.cilanthropist.co/inventory/pos/get/product_categories";
    $.getJSON(url, function(json){  
       $.each(json, function(i, item) {
            // alert(item.name);
            $("#prod_cats").append("<button class=\"btn btn-md btn-block\" onclick=\"ajaxGetProducts("+item.id+")\" style=\"background-color: #556E93; color: #ffffff;\">"+item.name+"</button>");
        });
    });
}
function ajaxGetProducts(cid)
{

    $( "#prods" ).empty();
    $("#prods").append("<div class=\"col-md-12\"><h2>Loading products...</h2></div>");

    
    var url = "http://erp.cilanthropist.co/inventory/pos/get/products/"+cid;
    $.getJSON(url, function(json){  
        $( "#prods" ).empty();
        var count = 0;
       $.each(json, function(i, item) {
        count++;
        var price = 0;
        if (item.srp != null) {
            price = item.srp;
        } 

        var img = "http://nahmdong.com/vitalhill/img/default.png";
        if (item.image_url != null) {
            img = item.image_url;
        }

            $("#prods").append("<div class=\"col-md-3\">\
                    <a href=\"#\" style=\"text-decoration: none;\" onclick=\"addToCart('"+item.name+"',"+price+")\">\
                    <div class=\"thumbnail\">\
                        <img src="+img+" style=\"height: 180px; width: 100%; display: block;\">\
                        <div class=\"caption\" style=\"font-size: 14px !important;\">\
                            <h3 style=\"font-size: 14px !important; margin: 0!important;\">"+item.name+"</h3>\
                            <h3 style=\"font-size: 14px !important; margin: 0!important;\"><b>PHP "+price+"</b></h3>\
                        </div>\
                    </div>\
                    </a>\
                </div>");

        });

       if (count == 0) {
            $( "#prods" ).empty();
            $("#prods").append("<div class=\"col-md-12\"><h2>No products in selected category</h2></div>");
       }
    });
}
$(document).ready(function(){
    ajaxGetProductCategories();

    $("#prods").append("<div class=\"col-md-12\"><h2>Select a product categoy</h2></div>");

    $(document).on("click",".remove_row", function(e){
            e.preventDefault();            
            var tr = $(this).closest('tr');
            // var srp = parseInt($(this).closest('qty'));
            // var total = parseInt($("#cart_price").text());
            //     total = total + parseInt(srp);
            // $("#cart_price").text(total.toString());
            tr.remove();
            return false;
        });
});
</script>
{% endblock %}