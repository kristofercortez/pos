{% extends "GistTemplateBundle::base.html.twig" %}
{% import "GistTemplateBundle::form.html.twig" as form_tools %}
{% block content %}
<!-- CART VARS -->
<input type="hidden" id="float_cart_minimum_total" value="0">
<input type="hidden" id="float_cart_orig_price" value="0">
<input type="hidden" id="float_cart_new_price" value="0">
<!-- END CART VARS -->
<!-- TRANSACTION VARS -->
<input type="hidden" id="float_trans_amount" name="float_trans_amount" value="0">
<input type="hidden" id="float_trans_balance" name="transaction_balance" value="0">
<input type="hidden" id="string_trans_type" value="none">
<input type="hidden" id="string_trans_mode" value="normal">
<input type="hidden" id="transaction_customer_id" name="transaction_customer_id" value="0">
<input type="hidden" id="transaction_system_id" name="transaction_system_id" value="{{next_sys_id|default(0)}}">
<input type="hidden" id="transaction_display_id" name="transaction_display_id" value="{{next_id|default(0)}}">
<input type="hidden" id="transaction_status" name="transaction_status" value="{{status|default('null')}}">
<!-- END TRANSACTION VARS -->
<!-- TAX VARS -->
<input type="hidden" id="float_tax_rate" value="0">
<input type="hidden" id="float_orig_tax_vat_amt" value="0">
<input type="hidden" id="float_new_tax_vat_amt" value="0">
<input type="hidden" id="float_orig_tax_amt_net_vat" value="0">
<input type="hidden" id="float_new_tax_amt_net_vat" value="0">
<input type="hidden" id="string_tax_coverage" value="{{tax_coverage|default('none')}}">
<input type="hidden" id="float_orig_excl_total" value="0">
<input type="hidden" id="float_new_excl_total" value="0">
<!-- END TAX VARS -->
<!-- OLD VARS -->
<input type="hidden" id="session_vat" name="session_vat" value="0">
<input type="hidden" id="cart_min_price" name="cart_min_price" value="0">
<input type="hidden" id="cart_int_price" name="cart_int_price" value="0">
<input type="hidden" id="float_cart_orig_price" name="float_cart_orig_price" value="0">
<input type="hidden" id="transaction_amt_to_pay" name="transaction_amt_to_pay" value="0">
<input type="hidden" id="transaction_balance" name="transaction_balance" value="0">
<input type="hidden" id="reg_trans_flag" name="reg_trans_flag" value="0">
<input type="hidden" id="bulk_opt_sel" name="bulk_opt_sel" value="">
<input type="hidden" id="tax_coverage" name="tax_coverage" value="{{tax_coverage|default('none')}}">
<!-- END OLD VARS -->
<div class="page-content">
    <br>
    <div class="row" style="margin-right: 0px !important;">
        <div class="col-md-2" style="padding-right: 1px !important; border: 0px !important;">
        	<div class="portlet box " style="background-color: #292929 !important;border: 0px !important;">
                <div class="portlet-title">
                    <div class="caption">Product Categories</div>
                </div>
                <div class="portlet-body form" id="prod_cats" style="height: 400px; overflow:scroll;overflow-x: hidden;">
                	
                </div>
                <div style="background-color: #ffffff !important;">
                &nbsp;&nbsp;
                
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="portlet box" style="background-color: #292929 !important;border: 0px !important;"> 
                <div class="portlet-title">
                    <div class="caption">Products</div>
                </div>
                <div class="portlet-body">
                    <br>
                    <div  style="height: 410px;overflow:scroll; overflow-x: hidden;">
                        <div class="row" id="prods">
                    
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="portlet box" style="background-color: #292929 !important;border: 0px !important;"> 
                <div class="portlet-title">
                    <div class="caption">Cart - Transaction {{next_id|default('0')}}</div>
                </div>
                <div class="portlet-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div style="overflow:scroll; overflow-x: hidden; height: 280px;">
                                <table class="table table-striped table-bordered table-hover" style="margin-top: 10px;" id="cart_table">
                                    <thead>
                                        <tr>
                                            <th width="60%">Item</th>
                                            <th width="25%">Price</th>
                                            <th width="10%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="cart_items">
                                        <tr class="init_row_prods">
                                            <td colspan="3" class="xrow"><p>No items added</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-md-12" >
                                    <a href="javascript:void(0)" class="btn next_step_btn" style="background-color: #556E93; color: #ffffff;">Next Step</a>
                                    <a href="javascript:void(0)" class="btn bulk_adj" style="background-color: #556E93; color: #ffffff;">Bulk Discount</a>
                                    <a href="javascript:void(0)" class="btn checkout_btn" style="background-color: green; color: #ffffff;">Checkout</a>
                                    <a href="javascript:void(0)" class="btn clear_discount" style="background-color: orange; color: #ffffff;">Reset Transaction Type</a>
                                    <a href="" class="btn" style="background-color: red; color: #ffffff;">Clear Cart</a>
                                    <br>
                                    <br>
                                    <h4 class="bulk_discount_h4">Bulk Discount: <b><span id="applied_bulk_discount" value="">None</span></b></h4>
                                    <h4 class="savings_h4">You saved: <b>Php <span id="customer_savings" value="">0.00</span></b></h4>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table table-striped table-bordered table-hover" style="" id="cart_totals_table">
                                        <thead>
                                            <tr>
                                                <th width="40%" style="font-size: 12px;">Amount</th>
                                                <th width="30%" style="font-size: 12px;">Amt Net of VAT</th>
                                                <th width="30%" style="font-size: 12px;">VAT</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="initial_totals">
                                                <td><p style="font-size:12px;" class="cart_price_h3">Total <b>Php <span class="initial_cart_price" value="0">0</span></b></p></td>
                                                <td><p style="font-size:12px;" class="new_amt_vat"><b>Php <span id="initial_amt_net_vat" value="0">0</span></b></p></td>
                                                <td><p style="font-size:12px;" class="new_vat"><b>Php <span id="initial_vat_amt" value="0">0</span></b></p></td>
                                            </tr>
                                            <tr class="updated_totals_row">
                                                <td><p style="font-size:12px;" class="updated_price_h3">Updated<b>Php <span class="updated_cart_price" value="0">0</span></b></p></td>
                                                <td><p style="font-size:12px;" class="updated_amt_vat"><b>Php <span id="updated_amt_net_vat" value="0">0</span></b></p></td>
                                                <td><p style="font-size:12px;" class="updated_vat"><b>Php <span id="updated_vat_amt" value="0">0</span></b></p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="bulk_adjustment" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Bulk Discount Form</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-3" class="proceed_btn_reg" onclick="updateBulkForm('bgift')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk1.png') }}"></a>
                                <h4>Gift</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_per"  onclick="updateBulkForm('bdisc')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk2.png') }}"></a>
                                <h4>Discount %</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_bulk"  onclick="updateBulkForm('bdiscamt')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk3.png') }}"></a>
                                <h4>Discount</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_bulk"  onclick="updateBulkForm('bamt')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk4.png') }}"></a>
                                <h4>Amount to Pay</h4>
                            </div>
                            <div style="margin-bottom: 25px;">&nbsp;</div>
                            {{ form.group_text('Selected Bulk Discount', 'selected_bulk', 'None', 4, 5, true) }}
                            {{ form.group_text('New Price', 'new_total', '', 4, 5, false) }}
                            {{ form.group_text('Less Amount', 'discount_amount', '', 4, 5, false) }}
                            {{ form.group_text('Less %', 'discount_pct', '', 4, 5, false) }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green apply_bulk" data-dismiss="modal" style="margin=0" href="javascript:void(0)">Apply</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="transaction_type_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Select Transaction Type</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-4" class="proceed_btn_reg" onclick="proceedToTransaction('reg')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/regular_trans.png') }}"></a>
                                <h4>Regular Transaction</h4>
                            </div>
                            <div class="col-md-4" class="proceed_btn_per"  onclick="proceedToTransaction('per')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/per_trans.png') }}"></a>
                                <h4>Per Item Discount</h4>
                            </div>
                            <div class="col-md-4" class="proceed_btn_bulk"  onclick="proceedToTransaction('bulk')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk_trans.png') }}"></a>
                                <h4>Bulk Discount</h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green proceed_btn" style="margin=0" href="javascript:void(0)">Proceed</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="checkout_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Checkout & Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay" value="0">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance" value="0">0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-2">
                                <div style="margin-top: 15px;"></div>
                                <a href="javascript:void(0)" class="co_cash_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_cash.png') }}" width="70px" width="70px"></a>
                                <a href="javascript:void(0)" class="co_cc_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_card.png') }}" width="70px"></a>
                                <a href="javascript:void(0)" class="co_check_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_check.png') }}" width="70px"></a>
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_gc.png') }}" width="70px"></a>
                            </div>
                            <div class="col-md-10">
                                <div style="overflow:scroll; overflow-x: hidden; height: 250px;">
                                    <table class="table table-striped table-bordered table-hover" style="margin-top: 10px;" id="payments_table">
                                        <thead>
                                            <tr>
                                                <th width="40%">Type</th>
                                                <th width="50%">Amount</th>
                                                <th width="10%"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="payments_list">
                                            <tr class="init_row_payment">
                                                <td colspan="3"><p>No payments added</p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green finish_btn" style="margin=0" href="javascript:void(0)">Finish</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="cash_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Cash Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance_disp" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 20px;">
                            <div class="col-md-12">
                                {{ form.group_text('Received Amount', 'cash_received_amt', '', 4, 4, false) }}
                                <div class="row">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="7">7</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="8">8</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="9">9</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="4">4</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="5">5</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="6">6</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="1">1</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="2">2</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="3">3</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important; margin-bottom: 10px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default white" style="color: white !important; background-color: white !important; cursor: default !important;">0</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="0">0</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value=".">.</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important; margin-bottom: 10px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn default red numeric_key" data-value="CLEAR">Clear</a>
                                        <a href="javascript:void(0)" class="btn default red numeric_key" data-value="DEL">Delete</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                {#{{ form.group_hidden('Change Amount', 'cash_chg_amt', '0.00', 4, 4, true) }}#}
                                <br>
                                <h4>Change <b>Php <span id="cash_chg_amt" >0.00</span></b></h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green cash_proceed_btn" style="margin=0" href="javascript:void(0)">Submit</a>
                        <a class="btn default cash_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                        {#<button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>#}
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="cc_modal"  class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" style="width: 800px !important;">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Card Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance_disp" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form cc_main_form" style="margin-top: 20px;">
                            <div class="col-md-12" id="cc_form" style="height: 350px; overflow:scroll;overflow-x: hidden;">
                                <div class="cc_field">
                                    <h4 class="form-section">Card Details</h4>
                                    <div class="row">
                                        <div class="col-md-5">
                                            {{ form.group_selectx('Terminal Operator', 'cc_terminal_operator', terminal_operators, '', 5, 6, false) }}
                                            {{ form.group_text_pos('Charge Amount', 'cc_charge_amt', '', 5, 6, '', false) }}
                                            {{ form.group_selectx('Payment Terms', 'cc_terms', charge_rates, '', 5, 6, '',false) }}
                                            {{ form.group_selectx('Bank of card', 'cc_bank', bank_options, '', 5, 6, '',false) }}
                                            {{ form.group_selectx('Card Class', 'cc_card_class', card_class, '', 5, 6, '',false) }}
                                        </div>
                                        <div class="col-md-7">
                                            {{ form.group_text_pos('Card Number', 'cc_card_number', '', 4, 7, 'Card Number', false) }}
                                            {{ form.group_text_pos('Name on Card', 'cc_card_name', '', 4, 7, 'Name on Card', false) }}
                                            {{ form.group_text_pos('Expiration Date', 'cc_card_expiry', '', 4, 7, 'mm/yyyy', false) }}
                                            {{ form.group_text_pos('CVV', 'cc_card_cvv', '', 4, 7, 'CVV', false) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="javascript:void(0)" class="btn blue add_card_btn">Add Card</a>
                        <a class="btn default green card_proceed_btn" style="margin=0" href="javascript:void(0)">Submit</a>
                        <a class="btn default cc_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="check_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" style="width: 800px !important;">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Check Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance_disp" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 20px;">
                            <div class="col-md-12" id="check_form" style="height: 300px; overflow:scroll;overflow-x: hidden;">
                                <div class="check_field">
                                    <h4 class="form-section">Check Details</h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            {{ form.group_selectx2('Bank', 'check_bank', bank_options, '', 5, 6, false) }}
                                            {{ form.group_text_pos('Account Number', 'check_account_number', '', 5, 6, false) }}
                                            {{ form.group_text_pos('Check Number', 'check_number', '', 5, 6, false) }}
                                            {{ form.group_text_pos('Check Amount', 'check_amount', '', 5, 6, false) }}
                                        </div>
                                        <div class="col-md-6">
                                            {{ form.checkbox_pos('check_is_pdc', 0, 'Post dated check', '', '')}}
                                            {{ form.group_date_pos('Check Date','check_date', '',5, 6) }}
                                            {{ form.group_text_pos("Payee's Name", 'check_payee_name', '', 5, 6, false) }}
                                            {{ form.group_text_pos("Payor's Name", 'check_payor_name', '', 5, 6, false) }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="javascript:void(0)" class="btn blue add_check_btn">Add Check</a>
                        <a class="btn default green check_proceed_btn" style="margin=0" href="javascript:void(0)">Submit</a>
                        <a class="btn default check_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="freeze_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Frozen Transactions</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 10px;">
                            <div class="col-md-12" id="check_form" style="height: 300px; overflow:scroll;overflow-x: hidden;">
                                <table class="table table-striped table-bordered table-hover" style="margin-top: 10px;" id="frozen_transactions">
                                    <thead>
                                        <tr>
                                            <th width="40%">Transaction ID</th>
                                            <th width="50%">Date Created</th>
                                            <th width="10%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="frozen_list">
                                        <tr class="init_row_frozen">
                                            <td colspan="3"><p>No frozen transactions</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default blue freeze_btn" style="margin=0" href="javascript:void(0)">Freeze Current Transaction</a>
                        <a class="btn default" data-dismiss="modal" style="margin=0" href="javascript:void(0)">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="customer_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" style="width: 700px !important;">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Search/Add customer</h4>
                    </div>
                    <div class="modal-body" id="cust_formx" style="height: 500px; overflow:scroll;overflow-x: hidden;">
                        <div class="row form-horizontal form">
                            <div class="col-md-6" id="check_form">
                                {{ form.group_text_pos('Customer ID', 'cust_search_id', '', 4, 7, false) }}
                            </div>
                            <div class="col-md-6" id="check_form">
                                {{ form.radio_set_pos('Gender', 'cust_search_gender', gender_options, null, false) }}
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-6" id="check_form">
                                {{ form.group_selectx2('Status', 'cust_search_marital', marital_options, '', 4, 7, false) }}
                            </div>
                            <div class="col-md-6" id="check_form">
                            {{ form.group_date_pos('Married On','cust_search_marriage_date', '',4, 7) }}

                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-5" id="check_form">
                                {{ form.group_text_pos('First Name', 'cust_search_firstname', '', 5, 6, false) }}
                            </div>
                            <div class="col-md-2" id="check_form">
                            {{ form.group_text_pos('MI', 'cust_search_middle_name', '', 2, 8, false) }}
                            </div>
                            <div class="col-md-5" id="check_form">
                                {{ form.group_text_pos('Last Name', 'cust_search_lastname', '', 5, 6, false) }}
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-6" id="check_form">
                                {{ form.group_text_pos('Home #', 'cust_search_home_phone', '', 4, 7, false) }}
                                {{ form.group_text_pos('Email','cust_search_email', '',4, 7) }}
                            </div>
                            <div class="col-md-6" id="check_form">
                                {{ form.group_text_pos('Mobile #', 'cust_search_mobile', '', 4, 7, false) }}
                                {{ form.group_date_pos('Birthday','cust_search_birthdate', '',4, 7) }}
                                
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-12" id="check_form">
                                {{ form.group_text_pos('Address 1', 'cust_search_address_1', '', 2, 9, false) }}
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-12" id="check_form">
                                {{ form.group_text_pos('Address 2', 'cust_search_address_2', '', 2, 9, false) }}
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-6" id="check_form">
                                {{ form.group_text_pos('City', 'cust_search_city', '', 4, 7, false) }}
                                {{ form.group_text_pos('Country','cust_search_country', '',4, 7) }}
                            </div>
                            <div class="col-md-6" id="check_form">
                                {{ form.group_text_pos('State', 'cust_search_state', '', 4, 7, false) }}
                                {{ form.group_text_pos('Zip','cust_search_zip', '',4, 7) }}
                                
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-12" id="check_form">
                                {{ form.group_textarea('Notes', 'cust_search_notes', '', 3, 2, 9, false) }}
                            </div>
                        </div>
                        <div class="row form-horizontal form customer_seach_main_div" >
                            <h4 id="form_title" class="modal-title">Search Results</h4>
                            <hr style="margin-top: 2px; margin-bottom: 10px;">
                            <div class="col-md-12" id="check_form" style="height: 160px; overflow:scroll;overflow-x: hidden;">
                            <table class="table table-striped table-bordered table-hover" id="customers_table">
                                    <thead>
                                        <tr>
                                            <th width="50%">Name</th>
                                            <th width="40%">E-mail</th>
                                            <th width="10%">Select</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customers_list">
                                        <tr class="init_row_customer">
                                            <td colspan="3"><p>No customer found</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                    <a class="btn default red customer_clear_search_btn" style="margin=0" href="javascript:void(0)">Clear Fields</a>
                        <a class="btn default green customer_search_btn" style="margin=0" href="javascript:void(0)">Search</a>
                        <a class="btn default blue save_customer_button" style="margin=0" href="javascript:void(0)">Add New Customer</a>
                        <a class="btn default blue customer_search_again_btn" style="margin=0" href="javascript:void(0)">Search Again</a>
                        <a class="btn default green customer_continue_btn" style="margin=0" href="javascript:void(0)">Continue</a>
                        <button type="button" class="btn default cancel_cust_search" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="final_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <h3 id="form_title" class="modal-title">Transaction complete!</h3>
                            <br>
                            <div class="col-md-4" class="proceed_btn_reg" onclick="finalModalAction('save')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/save.png') }}"></a>
                                <h4>Save</h4>
                            </div>
                            <div class="col-md-4" class="proceed_btn_reg" onclick="finalModalAction('save_print')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/receipt.png') }}"></a>
                                <h4>Save & Print Receipt</h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <p><i>Leaving this modal will reset the POS</i></p>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="quotation_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <h3 id="form_title" class="modal-title">Enable quotation mode?</h3>
                            <hr>
                            <p style="font-size: 18px;">To go back to normal mode, press the quotation icon again.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green quotation_continue_btn" style="margin=0" href="javascript:void(0)">Yes</a>
                        <a class="btn red default" data-dismiss="modal" style="margin=0" href="javascript:void(0)">No</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="rev_quotation_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <h3 id="form_title" class="modal-title">Disable quotation mode?</h3>
                            <hr>
                            <p style="font-size: 18px;">This will revert back to normal mode.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green quotation_continue_btn" style="margin=0" href="javascript:void(0)">Yes</a>
                        <a class="btn red default" data-dismiss="modal" style="margin=0" href="javascript:void(0)">No</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="hidden">
    <div id="cc_fields">
        <div class="cc_field">
            <br>
            <h4 class="form-section">Card Details</h4>
            <div class="row">
                <div class="col-md-5">
                    {{ form.group_selectx('Terminal Operator', 'cc_terminal_operator', terminal_operators, '', 5, 6, false) }}
                    {{ form.group_text_pos('Charge Amount', 'cc_charge_amt', '', 5, 6, '', false) }}
                    {{ form.group_selectx('Payment Terms', 'cc_terms', charge_rates, '', 5, 6, '',false) }}
                    {{ form.group_selectx('Bank of card', 'cc_bank', bank_options, '', 5, 6, '',false) }}
                    {{ form.group_selectx('Card Class', 'cc_card_class', card_class, '', 5, 6, '',false) }}
                </div>
                <div class="col-md-7">
                    {{ form.group_text_pos('Card Number', 'cc_card_number', '', 4, 7, 'Card Number', false) }}
                    {{ form.group_text_pos('Name on Card', 'cc_card_name', '', 4, 7, 'Name on Card', false) }}
                    {{ form.group_text_pos('Expiration Date', 'cc_card_expiry', '', 4, 7, 'MM/YYYY', false) }}
                    {{ form.group_text_pos('CVV', 'cc_card_cvv', '', 4, 7, 'CVV', false) }}
                </div>
            </div>
        </div>
    </div>
    <div id="check_fields">
        <div class="check_field">
            <br>
            <h4 class="form-section">Check Details</h4>
            <div class="row">
                <div class="col-md-6">
                    {{ form.group_selectx2('Bank', 'check_bank', bank_options, '', 5, 6, false) }}
                    {{ form.group_text_pos('Account Number', 'check_account_number', '', 5, 6, false) }}
                    {{ form.group_text_pos('Check Number', 'check_number', '', 5, 6, false) }}
                    {{ form.group_text_pos('Check Amount', 'check_amount', '', 5, 6, false) }}
                </div>
                <div class="col-md-6">
                    {{ form.checkbox_pos('check_is_pdc', 0, 'Post dated check', '', '')}}
                    {{ form.group_date_pos('Check Date','check_date', '',5, 6) }}
                    {{ form.group_text_pos("Payee's Name", 'check_payee_name', '', 5, 6, false) }}
                    {{ form.group_text_pos("Payor's Name", 'check_payor_name', '', 5, 6, false) }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script>
function finalModalAction(opt)
{
    if (opt == 'save') {
        $('#final_modal').modal('hide');
        swal('Transaction saved!','Resetting POS...please wait','success');
        location.reload();
    } else {

    }
}

function ajaxGetProductCategories()
{
    $( "#prod_cats" ).empty();
    $( "#prods" ).empty();
    $("#prod_cats").append("<div style=\"height: 10px;\">");
    // var url = "http://dev.gisterp2/inventory/pos/get/product_categories";
    var url = "http://erp.cilanthropist.co/inventory/pos/get/product_categories";
    $.getJSON(url, function(json){  
       $.each(json, function(i, item) {
            var img = "http://nahmdong.com/vitalhill/img/default.png";
            if (item.image_url != null) {
                img = item.image_url;
            }
            // alert(item.name);
            $("#prod_cats").append("<button class=\"btn btn-md btn-block category_btn\" id=\"cat_btn_"+item.id+"\" onclick=\"ajaxGetProducts("+item.id+")\" style=\"background-color: #556E93; color: #ffffff; border-radius: 5px !important;\">"+item.name+"</button>");

            $("#prods").append("<div class=\"col-md-4\" style=\"margin: 0px !important; padding: 1px !important\" >\
                    <a href=\"javascript:void(0)\" class=\"category_btn2\" style=\"text-decoration: none;\" onclick=\"ajaxGetProducts("+item.id+")\">\
                    <div class=\"thumbnail\" style=\"margin: 0px !important;border-width: 1px !important; border-color: #5d5d5d !important; border-radius: 5px !important;\">\
                        <img src="+img+" style=\"height: 60px; width: 50%; display: block;\">\
                        <div class=\"caption\" style=\"font-size: 10px !important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">\
                            <h3 style=\"font-size: 10px !important; margin: 0!important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">"+item.name+"</h3>\
                        </div>\
                    </div>\
                    </a>\
                </div>");
        });
    });
}

function ajaxGetProducts(cid)
{

    $( "#prods" ).empty();
    $("#prods").append("<div class=\"col-md-12\"><h2>&nbsp;&nbsp;&nbsp;Loading products...</h2></div>");
    $("#cat_btn_"+cid).css({'background-color': '#484c50'});
    $( "#prods" ).empty();
    
    // var url = "http://dev.gisterp2/inventory/pos/get/products/"+cid;
    var url = "http://erp.cilanthropist.co/inventory/pos/get/products/"+cid;
    $.getJSON(url, function(json){  
        var count = 0;
       $.each(json, function(i, item) {
        count++;
        var price = 0;
        var orig_srp = 0;
        if (item.srp != null) {
            price = item.srp;
        } 

        if (item.orig_srp != null) {
            orig_srp = item.orig_srp;
        } 

        var img = "http://nahmdong.com/vitalhill/img/default.png";
        if (item.image_url != null) {
            img = item.image_url;
        }

            $("#prods").append("<div class=\"col-md-4\" style=\"margin: 0px !important; padding: 2px !important\" >\
                    <a href=\"javascript:void(0)\" style=\"text-decoration: none;\" onclick=\"addToCart('"+item.name+"',"+price+","+item.min_price+","+item.id+")\">\
                    <div class=\"thumbnail\" style=\"margin: 0px !important; border-width: 1px !important; border-color: #5d5d5d !important; border-radius: 5px !important;\">\
                        <img src="+img+" style=\"height: 60px; width: 50%; display: block;\">\
                        <div class=\"caption\" style=\"font-size: 10px !important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">\
                            <h3 style=\"font-size: 10px !important; margin: 0!important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">"+item.name+"</h3>\
                            <h3 style=\"font-size: 12px !important; margin: 0!important;\"><b>PHP "+orig_srp+"</b></h3>\
                        </div>\
                    </div>\
                    </a>\
                </div>");

        });

       if (count == 0) {
            $( "#prods" ).empty();
            $("#prods").append("<div class=\"col-md-12\"><div class=\"alert alert-warning\"> <h2>&nbsp;&nbsp;No products in selected category</h2></div></div>");
       }
    });
}

function ajaxSearchCustomer()
{


    var first_name = "%20"; if($('#cform-cust_search_firstname').val() != ''){first_name = $('#cform-cust_search_firstname').val()};
    var middle_name = "%20"; if($('#cform-cust_search_middle_name').val() != ''){middle_name = $('#cform-cust_search_middle_name').val()};
    var last_name = "%20"; if($('#cform-cust_search_lastname').val() != ''){last_name = $('#cform-cust_search_lastname').val()};//$('#cform-cust_search_lastname').val();
    var email = "%20"; if($('#cform-cust_search_email').val() != ''){email = $('#cform-cust_search_email').val()};//$('#cform-cust_search_email').val();
    var number = "%20"; if($('#cform-cust_search_mobile').val() != ''){number = $('#cform-cust_search_mobile').val()};//$('#cform-cust_search_mobile').val();

    var customer_id = "%20"; if($('#cform-cust_search_id').val() != ''){customer_id = $('#cform-cust_search_id').val()};
    var gender = "%20"; if($("input[name='cust_search_gender']").is(":checked")){gender = $("input[name='cust_search_gender']:checked").val()} ;
    var marital_status = "%20"; if($('.cust_search_marital').val() != '' && $('.cust_search_marital').val() != 'undefined'){marital_status = $('.cust_search_marital').val()};
    var date_married = "%20"; if($('#cform-cust_search_marriage_date').val() != ''){date_married = $('#cform-cust_search_marriage_date').val()};
    var home_phone = "%20"; if($('#cform-cust_search_home_phone').val() != ''){home_phone = $('#cform-cust_search_home_phone').val()};
    var birthday = "%20"; if($('#cform-cust_search_birthdate').val() != ''){birthday = $('#cform-cust_search_birthdate').val()};
    var address1 = "%20"; if($('#cform-cust_search_address_1').val() != ''){address1 = $('#cform-cust_search_address_1').val()};
    var address2 = "%20"; if($('#cform-cust_search_address_2').val() != ''){address2 = $('#cform-cust_search_address_2').val()};

    var city = "%20"; if($('#cform-cust_search_city').val() != ''){city = $('#cform-cust_search_city').val()};
    var state = "%20"; if($('#cform-cust_search_state').val() != ''){state = $('#cform-cust_search_state').val()};
    var country = "%20"; if($('#cform-cust_search_country').val() != ''){country = $('#cform-cust_search_country').val()};
    var zip = "%20"; if($('#cform-cust_search_zip').val() != ''){zip = $('#cform-cust_search_address_2').val()};

    $('#customers_list').empty();
    
    // var url = "http://dev.gisterp2/inventory/pos/get/products/"+cid;
    var url = "http://erp.cilanthropist.co/customer/pos/search/"+first_name+"/"+last_name+"/"+email+"/"+number+"/"+middle_name+"/"+customer_id+"/"+gender+"/"+marital_status+"/"+date_married+"/"+home_phone+"/"+birthday+"/"+address1+"/"+address2+"/"+city+"/"+state+"/"+country+"/"+zip;


    url.replace('%2F','');
    $.getJSON(url, function(json){  
        var count = 0;
       $.each(json, function(i, cust) {
        count++;
        var name = cust.last_name + ', ' + cust.first_name;


        
        $('.init_row_customer').remove();
        var field = '<tr class=\"row_cust_'+cust.id+'\">';    
            field += '<input type="hidden" class="first_name" value="'+cust.first_name+'">';
            field += '<input type="hidden" class="last_name" value="'+cust.last_name+'">';
            field += '<input type="hidden" class="email" value="'+cust.email+'">';
            field += '<input type="hidden" class="number" value="'+cust.number+'">';
            field += '<input type="hidden" class="middle_name" value="'+cust.middle_name+'">';
            field += '<input type="hidden" class="id" value="'+cust.id+'">';
            field += '<input type="hidden" class="gender" value="'+cust.gender+'">';
            field += '<input type="hidden" class="marital_status" value="'+cust.marital_status+'">';
            field += '<input type="hidden" class="date_married" value="'+cust.date_married+'">';
            field += '<input type="hidden" class="home_phone" value="'+cust.home_phone+'">';
            field += '<input type="hidden" class="birthdate" value="'+cust.birthdate+'">';
            field += '<input type="hidden" class="address1" value="'+cust.address1+'">';
            field += '<input type="hidden" class="address2" value="'+cust.address2+'">';
            field += '<input type="hidden" class="city" value="'+cust.city+'">';
            field += '<input type="hidden" class="state" value="'+cust.state+'">';
            field += '<input type="hidden" class="country" value="'+cust.country+'">';
            field += '<input type="hidden" class="zip" value="'+cust.zip+'">';
            field += '<input type="hidden" class="notes" value="'+cust.notes+'">';
            field += '<td><input type="text" style=\"font-size: 12px !important;\" name="customer_name[]" value="'+name+'" readonly="true" class="form-control customer_name"></td>';
            field += '<td><input type="text" style=\"font-size: 12px !important;\" name="customer_email[]" class="form-control customer_email" readonly="true" value="'+cust.email+'"></td>';  
            field += '<td><a href="javascript:void(0)" class="btn btn-xs default green use_customer_btn"><i class="fa fa-eye" aria-hidden="true"></i></a></td>'; 
            field += '</tr>';

            $('#customers_list').prepend(field);

        });

       if (count == 0) {
            var field = '<tr class=\"init_row_prods\">';     
            field += '<td colspan=\"3\"><p>No customer found &nbsp;&nbsp;&nbsp;<a href="javascript:void(0)" class="add_customer btn btn-xs default blue">Add Customer</a></p></td>';
            field += '</tr>';

            $('#customers_list').prepend(field);
       }
    });
}

function ajaxAddCustomer()
{

    var first_name = "%20"; if($('#cform-cust_search_firstname').val() != ''){first_name = $('#cform-cust_search_firstname').val()};
    var middle_name = "%20"; if($('#cform-cust_search_middle_name').val() != ''){middle_name = $('#cform-cust_search_middle_name').val()};
    var last_name = "%20"; if($('#cform-cust_search_lastname').val() != ''){last_name = $('#cform-cust_search_lastname').val()};//$('#cform-cust_search_lastname').val();
    var email = "%20"; if($('#cform-cust_search_email').val() != ''){email = $('#cform-cust_search_email').val()};//$('#cform-cust_search_email').val();
    var number = "%20"; if($('#cform-cust_search_mobile').val() != ''){number = $('#cform-cust_search_mobile').val()};//$('#cform-cust_search_mobile').val();

    var customer_id = "%20"; if($('#cform-cust_search_id').val() != ''){customer_id = $('#cform-cust_search_id').val()};
    var gender = "%20"; if($("input[name='cust_search_gender']").is(":checked")){gender = $("input[name='cust_search_gender']:checked").val()} ;
    var marital_status = "%20"; if($('.cust_search_marital').val() != '' && $('.cust_search_marital').val() != 'undefined'){marital_status = $('.cust_search_marital').val()};
    var date_married = "%20"; if($('#cform-cust_search_marriage_date').val() != ''){date_married = $('#cform-cust_search_marriage_date').val()};
    var home_phone = "%20"; if($('#cform-cust_search_home_phone').val() != ''){home_phone = $('#cform-cust_search_home_phone').val()};
    var birthday = "%20"; if($('#cform-cust_search_birthdate').val() != ''){birthday = $('#cform-cust_search_birthdate').val()};
    var address1 = "%20"; if($('#cform-cust_search_address_1').val() != ''){address1 = $('#cform-cust_search_address_1').val()};
    var address2 = "%20"; if($('#cform-cust_search_address_2').val() != ''){address2 = $('#cform-cust_search_address_2').val()};

    var city = "%20"; if($('#cform-cust_search_city').val() != ''){city = $('#cform-cust_search_city').val()};
    var state = "%20"; if($('#cform-cust_search_state').val() != ''){state = $('#cform-cust_search_state').val()};
    var country = "%20"; if($('#cform-cust_search_country').val() != ''){country = $('#cform-cust_search_country').val()};
    var zip = "%20"; if($('#cform-cust_search_zip').val() != ''){zip = $('#cform-cust_search_address_2').val()};




    var url = "http://erp.cilanthropist.co/customer/pos/add/"+first_name+"/"+last_name+"/"+email+"/"+number+"/"+middle_name+"/"+gender+"/"+marital_status+"/"+date_married+"/"+home_phone+"/"+birthday+"/"+address1+"/"+address2+"/"+city+"/"+state+"/"+country+"/"+zip;

    $.getJSON(url, function(json){  
        var count = 0;
       $.each(json, function(i, cust) {
            //var new_customer_id = cust.new_customer_id
            //toastr['success']('Customer added', 'Success');
            swal("Success!", 'Customer added!',"success");
            $('#transaction_customer_id').val(cust.new_customer_id);
            $('#customer_modal').modal('hide');
            
            if ($('#string_trans_type').val() != 'none' && parseFloat($('#float_trans_balance').val()) <= 0) {

                $('#final_modal').modal('show');
            }
        });
    });
    clearCustomerAdd();
    


}

function clearCustomerAdd()
{
    $('#cform-cust_firstname').val('');
    $('#cform-cust_lastname').val('');
    $('#cform-cust_email').val('');
    $('#cform-cust_mobile').val('');
}

function addDashes(nStr)
{
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + '-' + '$2');
    }
    return x1 + x2;
}

function addCommas(nStr)
{
    console.log('addCommas: '+nStr);
    if (nStr != "" && parseFloat(nStr) > 0) {
        nStr = nStr.toFixed(2);
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }

        var ret_val = x1+x2;
        return ret_val;
    } else {
        return "0.00";
    }
}

function round(value, exp) {
  if (typeof exp === 'undefined' || +exp === 0)
    return Math.round(value);

  value = +value;
  exp = +exp;

  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0))
    return NaN;

  // Shift
  value = value.toString().split('e');
  value = Math.round(+(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp)));

  // Shift back
  value = value.toString().split('e');
  return +(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp));
}

function ajaxGetVAT()
{
    var url = "http://erp.cilanthropist.co/inventory/pos/get/vat";
    var vat = 0;
    $.getJSON(url, function(json){  
        $('#float_tax_rate').val(json)
    });
}

function addToCart(product_name, srp, min_price, id)
{
    var trans_type = $('#string_trans_type').val();
    if (trans_type == 'bulk') {
        sweetAlert("Can't add item!", "Reset transaction type to add item/s", "error");
    } else {
        $('.init_row_prods').remove();
        var row_id = Math.round(new Date().getTime() + (Math.random() * 100));
        var field = '<tr class=\"row_prod_'+row_id+'\">';     
            field += '<input type=\"hidden\" name=\"product_id[]\" class=\"product_id\" value=\"'+row_id+'\" >';
            field += '<input type=\"hidden\" name=\"min_price[]\" class=\"min_price\" value=\"'+min_price+'\" >';
            field += '<input type=\"hidden\" name=\"srp[]\" class=\"srp\" value=\"'+srp+'\" >';
            field += '<input type=\"hidden\" name=\"product_amt[]\" class=\"product_amt\" value=\"'+srp+'\" >';
            field += '<td><input type="text" style=\"font-size: 10px !important;\" value="'+product_name+'" readonly="true" class="form-control item_name"></td>';
            field += '<td><input type="text" style=\"font-size: 10px !important;\" name="display_price[]" class="form-control display_price" readonly="true" value="'+srp+'"></td>';  
            field += '<td ><a href="javascript:void(0)" class="btn btn-xs default red remove_row"><i class="fa fa-times" aria-hidden="true"></i></a></td>'; 
            field += '</tr>';

            $('#cart_items').prepend(field);
            // if there is already a discount type applied
            if($('#string_trans_type').val() == 'per') {
                appendPerItemFields();
            }

            //count number of products in cart
            var rowCount = $('#cart_table tr').length-1;
            $('.cart_items_count').text(rowCount.toString());

            //compute raw amounts/values (no alterations or discounts)
            if ($('#string_trans_type').val() == 'none') {
                computeCartRaw();
            } else if ($('#string_trans_type').val() == 'per') {
                computeCartRaw();
                computeCartIndiv();
            } else if ($('#string_trans_type').val() == 'reg') {
                computeCartRaw();
            } else if ($('#string_trans_type').val() == 'bulk') {
                computeCartRaw();
                applyBulkAdjustment();
            }
            // toastr['success'](product_name+' added to cart', 'Success');

            computeBalance();
    }

}

function addToPayments(payment_type, amount, details = null)
{
    $('.init_row_payment').remove();
    var row_id = Math.round(new Date().getTime() + (Math.random() * 100));
    var field = '<tr class=\"row_payment_'+row_id+'\">';     
        // field += '<input type=\"hidden\" name=\"product_id[]\" class=\"product_id\" value=\"'+row_id+'\" >';
        // field += '<input type=\"hidden\" name=\"min_price[]\" class=\"min_price\" value=\"'+min_price+'\" >';
        field += '<input type=\"hidden\" name=\"payment_details_array[]\" class=\"payment_details_array\" value=\"'+details+'\" >';
        field += '<input type=\"hidden\" name=\"payment_amt_float[]\" class=\"payment_amt_float\" value=\"'+amount+'\" >';
        field += '<td><input type="text" style=\"font-size: 12px !important;\" name="payment_type[]" value="'+payment_type+'" readonly="true" class="form-control payment_type"></td>';
        field += '<td><input type="text" style=\"font-size: 10px !important;\" name="payment_amt[]" class="form-control payment_amt" readonly="true" value="'+addCommas(amount)+'"></td>';  
        field += '<td ><a href="javascript:void(0)" class="btn btn-xs default red remove_payment_row"><i class="fa fa-times" aria-hidden="true"></i></a></td>'; 
        field += '</tr>';

        $('#payments_list').prepend(field);
        toastr['success']('Payment added', 'Success');
        computeBalance();


}


function computeBalance()
{
    //sum payments first then subtract to transaction amount
    var payments = 0;
    var transaction_amount = $('#float_trans_amount').val();
    var balance = 0;
    $('.payment_amt_float').each(function(){
        payments = payments + parseFloat($(this).val());
    });

    balance = transaction_amount - payments;
    $('#float_trans_balance').val(balance);
    $('.co_balance').text(addCommas(balance));
    $('.co_balance_disp').text(addCommas(balance));

    if ($('#string_trans_type').val() == 'none') {

    } else if ($('#string_trans_type').val() == 'per') {

    } else if ($('#string_trans_type').val() == 'bulk') {

    } else {

    }
}

function computeBalanceDisplay(amt)
{

    var payments = amt;
    var transaction_amount = $('#float_trans_balance').val();
    var balance = 0;


    balance = transaction_amount - payments;
    $('.co_balance_disp').text(addCommas(balance));

    if ($('#string_trans_type').val() == 'none') {

    } else if ($('#string_trans_type').val() == 'per') {

    } else if ($('#string_trans_type').val() == 'bulk') {

    } else {

    }
}

32800

50


function computeBalanceDisplayCardMulti()
{
    var payments = 0;
    var transaction_amount = $('#float_trans_balance').val();
    var balance = 0;

    $('.cc_field').each(function() {
        // alert('payments: '+payments);
        var payment_amt = parseFloat($(this).find('#cform-cc_charge_amt').val()); 
        // alert('payment amt: '+payment_amt);
        if (payment_amt != '') {
            if (payment_amt > 0) {
                payments = parseFloat(payments) + parseFloat(payment_amt);
            } 
        } else {

        }
    });

    balance = parseFloat(transaction_amount) - parseFloat(payments);
    // alert('payments: '+payments+' balance: '+balance);
    $('.co_balance_disp').text(addCommas(balance));
}

function computeBalanceDisplayCheckMulti()
{
    var payments = 0;
    var transaction_amount = $('#float_trans_balance').val();
    var balance = 0;

    $('.check_field').each(function() {
        var payment_amt = $(this).find('#cform-check_amount').val(); 
        if (payment_amt != '') {
            if (payment_amt > 0) {
                payments = parseFloat(payments) + parseFloat(payment_amt);
            } else {

            }
        } else {

        }
    });

    balance = parseFloat(transaction_amount) - parseFloat(payments);
    // alert('payments: '+payments+' balance: '+balance);
    $('.co_balance_disp').text(addCommas(balance));
}

function computeCartRaw() 
{
    //this function will only compute RAW totals, not discounts/altered prices here
    var sale_price = 0;
    var minimum_price = 0;

    // compute each item's original price
    $('.display_price').each(function(){
        sale_price = sale_price + parseFloat($(this).val());
    });

    // compute each item's minimum price
    $('.min_price').each(function(){
        minimum_price = minimum_price + parseFloat($(this).val());
    });

    // assign new values
    $('#float_cart_orig_price').val(sale_price);
    $('#float_cart_minimum_total').val(minimum_price);

    // display new raw/original cart total
    $('.initial_cart_price').text(addCommas(sale_price));
    $('.updated_cart_price').text(addCommas(sale_price)); //will be overwritten by peritem/bulk if set
    $('.transaction_total').text(addCommas(sale_price));
    $('#transaction_amt_to_pay').val(addCommas(sale_price));
    $('#float_trans_amount').val(sale_price);

    // compute taxes and vat
    computeVATRaw(sale_price);

    // compute minimum
    computeCartMinimum();
}

function computeCartIndiv() 
{
    //this function will only compute PER ITEM totals.
    var sale_price = 0;


    // compute each item's original price
    $('.adjusted_price').each(function(){
        sale_price = sale_price + parseFloat($(this).val());
        // alert($(this).val());
    });

    var orig_price = $('#float_cart_orig_price').val();
    var savings = orig_price - sale_price;

    $('#customer_savings').text(addCommas(parseFloat(savings)));

    // assign new values
    $('#float_cart_new_price').val(sale_price);

    // display new cart total
    $('.updated_cart_price').text(addCommas(sale_price));
    $('.transaction_total').text(addCommas(sale_price));
    $('#transaction_amt_to_pay').val(addCommas(sale_price));
    $('#float_trans_amount').val(sale_price);
    // compute taxes and vat
    computeVATIndiv(sale_price);

    // compute minimum
    computeCartMinimum();

}

function computeCartBulk(sale_price) 
{
    // assign new values
    $('#float_cart_new_price').val(sale_price);

    // display new cart total
    $('.updated_cart_price').text(addCommas(sale_price));
    $('.transaction_total').text(addCommas(sale_price));
    $('#transaction_amt_to_pay').val(addCommas(sale_price));
    $('#float_trans_amount').val(sale_price);
    // compute taxes and vat
    computeVATIndiv(sale_price);

    // compute minimum
    computeCartMinimum();

}


function computeVATRaw(total)
{
    var tax_rate = parseFloat($('#float_tax_rate').val())/100;
    var tax_coverage = $('#string_tax_coverage').val();
    var vat_amt = 0;
    var amt_net_of_vat = 0;
    var incl_divisor = tax_rate + 1;


    if (tax_coverage == 'incl') {
        vat_amt = total*tax_rate;
        amt_net_of_vat = total - vat_amt;

        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $('#float_orig_tax_vat_amt').val(round(vat_amt,2));
        $('#float_orig_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#initial_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#initial_vat_amt").text(addCommas(round(vat_amt,2)));
        $("#updated_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#updated_vat_amt").text(addCommas(round(vat_amt,2)));
    } else if (tax_coverage == 'excl') {
        vat_amt = total - (total/incl_divisor);
        amt_net_of_vat = total - vat_amt;

        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $('#float_orig_tax_vat_amt').val(round(vat_amt,2));
        $('#float_orig_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#initial_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#initial_vat_amt").text(addCommas(round(vat_amt,2)));
        $("#updated_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#updated_vat_amt").text(addCommas(round(vat_amt,2)));
    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }


}

function computeVATIndiv(total)
{
    var tax_rate = parseFloat($('#float_tax_rate').val())/100;
    var tax_coverage = $('#string_tax_coverage').val();
    var vat_amt = 0;
    var amt_net_of_vat = 0;
    var incl_divisor = tax_rate + 1;
    // console.log("incl_divisor: "+incl_divisor);

    if (tax_coverage == 'incl') {
        vat_amt = total*tax_rate;
        amt_net_of_vat = total - vat_amt;
        
        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#updated_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#updated_vat_amt").text(addCommas(round(vat_amt,2)));
    } else if (tax_coverage == 'excl') {
        vat_amt = total - (total/incl_divisor);
        amt_net_of_vat = total - vat_amt;
        
        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#updated_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#updated_vat_amt").text(addCommas(round(vat_amt,2)));
    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }
}

function proceedToTransaction(x)
{
    var select_trans = x;
    if (select_trans != '') {
        if (select_trans == 'reg') {
            $('.next_step_btn').hide();
            $('.checkout_btn').show();
            $('#transaction_type_modal').modal('hide');
            $('.savings_h4').hide();
            $('.clear_discount').show();
            $('#string_trans_type').val('reg');
        } else if (select_trans == 'per') {
            $('#string_trans_type').val('per');
            $('.next_step_btn').hide();
            $('.savings_h4').show();
            $('.checkout_btn').show();
            appendPerItemColumns();
            appendPerItemFields();
            $('#transaction_type_modal').modal('hide');
            $('.updated_totals_row').show();
            $('.clear_discount').show();
        } else if (select_trans == 'bulk') {
            $('#string_trans_type').val('bulk');
            $('.updated_totals_row').show();

            $('.next_step_btn').hide();
            $('.savings_h4').show();
            $('.bulk_adj').show();
            $('#proc').show();
            $('#transaction_type_modal').modal('hide');
            $('#bulk_adjustment').modal('show');
            $('.bulk_discount_h4').show();
            $('.checkout_btn').show();
            $('.clear_discount').show();
        } else {
            $('.clear_discount').hide();
            $('#string_trans_type').val('none');
        }
    } else {
        $('.clear_discount').hide();
        $('#string_trans_type').val('none');
    }
}

function revertDiscounts()
{
    $('#cart_table').find('tr').each(function(){
        if ($(this).children('th').length > 5) {
            $(this).find('th').eq(2).remove();
            $(this).find('th').eq(2).remove();
            $(this).find('th').eq(2).remove();
        }

        if ($(this).children('td').length > 5) {
            $(this).find('td').eq(2).remove();
            $(this).find('td').eq(2).remove();
            $(this).find('td').eq(2).remove();
        }
    });

    var float_orig_price = parseFloat($('#float_cart_orig_price').val());
    $('#string_trans_type').val('none');
    $('.updated_totals_row').hide();
    $('.checkout_btn').hide();
    $('.bulk_adj').hide();
    $('#customer_savings').text("0.00");
    $('.next_step_btn').show();
    $('.clear_discount').hide();
    $('.initial_cart_price').text(addCommas(float_orig_price));
    $('#float_cart_new_price').val($('#float_cart_orig_price').val());



    // $('.cart_price_h3').css({'color': 'black'});
    $('#cgroup-new_total').hide();
    $('#cform-new_total').val('');
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    // $('.cart_price').text(addCommas($('#float_cart_orig_price').val()));
    
    computeCartRaw();
    $('.orig_totals_row').hide();
    $('.orig_price_h3').hide();
    $('.bulk_discount_h4').hide();
    $('#applied_bulk_discount').text('');
}

function computeCartMinimum()
{
    var total = 0;
    $('.min_price').each(function(){
        total = total + parseFloat($(this).val());
    });

    $("#float_cart_minimum_total").val(total);

    if ($('#string_trans_type').val() == 'none') {
        if (total > $('#float_cart_orig_price').val()) {
            $('.updated_price_h3').css({'color': 'red'});
        } else {
            $('.updated_price_h3').css({'color': 'black'});
        }
    } else {
        console.log('here @ com min: ' + $('#float_cart_new_price').val())
        if (total > $('#float_cart_new_price').val()) {
            $('.updated_price_h3').css({'color': 'red'});
        } else {
            $('.updated_price_h3').css({'color': 'black'});
        }
    }
    
    computeExtraAmount();
}

function computeExtraAmount()
{
    var cart_min_price = 0;
    var cart_price = 0;
    cart_min_price = parseInt($("#float_cart_minimum_total").val());

    if ($('#string_trans_type').val() == 'none') {
        cart_price = parseInt($("#float_cart_orig_price").val());
    } else {
        cart_price = parseInt($("#float_cart_new_price").val());
    }
    
    var extra_amt = cart_price - cart_min_price;
    var extra_amt_disp = addDashes(extra_amt.toString());
    $('#cart_min_pricex').text(addCommas(cart_min_price));
    $('#cart_pricex').text(addCommas(cart_price));
    $('#ea_amt').text(extra_amt_disp);
}

function apply_indiv(x)
{
    var row = $(x).closest('tr');
    var srp = row.find('.srp').val();
    var adjusted_price = row.find('.adjusted_price');
    var per_item_discount_amt = row.find('.per_item_discount_amt');


    if ($(x).val() == 'gift') {
        adjusted_price.val(0);
        per_item_discount_amt.attr("readonly", true); 
        per_item_discount_amt.val('');
    } else if ($(x).val() == 'disc') {
        adjusted_price.val(srp);
        per_item_discount_amt.val('');
        per_item_discount_amt.attr("readonly", false); 
    } else if ($(x).val() == 'chg') {
        adjusted_price.val(srp);
        per_item_discount_amt.val('');
        per_item_discount_amt.attr("readonly", false); 
    } else if ($(x).val() == 'discamt') {
        adjusted_price.val(srp);
        per_item_discount_amt.val('');
        per_item_discount_amt.attr("readonly", false); 
    }else {
        adjusted_price.val(srp);
        per_item_discount_amt.attr("readonly", true); 
        per_item_discount_amt.val('');
    }

    computeCartIndiv();
    computeBalance();
}

function applyBulkAdjustment()
{   
    var bulk_adj_opt = $('#bulk_opt_sel').val();
    if (bulk_adj_opt != '') {
        if (bulk_adj_opt == 'bgift') {
            computeCartBulk(0);
            $('#applied_bulk_discount').text('Gift');
        } else if (bulk_adj_opt == 'bdiscamt') {
            var new_cart_total = $('#float_cart_orig_price').val() - $('#cform-discount_amount').val();
            if (new_cart_total >= 0) {
                $('#applied_bulk_discount').text('Less Php '+$('#cform-discount_amount').val()+'');
                $('#customer_savings').text(addCommas(parseFloat($('#cform-discount_amount').val())));
                computeCartBulk(new_cart_total);
            } else {
                toastr['error']('Invalid discount amount.', 'Error');
            }
        } else if (bulk_adj_opt == 'bdisc') {
            var new_cart_total = $('#float_cart_orig_price').val() - ($('#float_cart_orig_price').val() * ($('#cform-discount_pct').val()/100));
            var savings = $('#float_cart_orig_price').val() * ($('#cform-discount_pct').val()/100);
            if (new_cart_total >= 0) {
                computeCartBulk(new_cart_total);
                $('#applied_bulk_discount').text('Less '+$('#cform-discount_pct').val()+'% off');
                $('#customer_savings').text(addCommas(parseFloat(savings)));
            } else {
                toastr['error']('Invalid discount.', 'Error');
            }
        } else if (bulk_adj_opt == 'bamt') {
            var savings = $('#float_cart_orig_price').val() - $('#cform-new_total').val();
            // alert(savings);
            computeCartBulk(parseFloat($('#cform-new_total').val()));
            $('#applied_bulk_discount').text('Change Amount');
            $('#customer_savings').text(addCommas(parseFloat(savings)));
        } else {
            $('.display_price').each(function() {
                if ($(this).val() == "0" || $(this).val() == "0.00") {
                    //revert prices only if bulk discount came from gift
                    var row = $(this).closest('tr');
                    var srp = row.find('.srp').val();
                    $(this).val(srp);
                }
            });
            $('#applied_bulk_discount').text('');
            computeCartBulk(0);
        }
    } else {

    }
    computeBalance();
}

function appendPerItemColumns()
{
    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(1).after('<th>Discount Type</th>');
    });

    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(2).after('<th>Value</th>');
    });

    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(3).after('<th>Adjusted Price</th>');
    });
    var ths = $('th');
    var element = ths.eq(0);
    element.width(100);
    var element2 = ths.eq(1);
    element2.width(70);
    var element2 = ths.eq(2);
    element2.width(80);
    var element2 = ths.eq(3);
    element2.width(70);
    var element2 = ths.eq(4);
    element2.width(70);
}

function appendPerItemFields()
{
    if ($('#string_trans_type').val() == "per") {
        $('#cart_table').find('tr').each(function(){
            if ($(this).children('td').length < 6) {
                $(this).find('td').eq(1).after("<td style=\"font-size: 10px !important;\">\
                    {{ form.group_select_only3('Type', 'indiv_disc_opt', indiv_options, '', 12, 12, false)|e('js') }}</td>");
                $(this).find('td').eq(2).after("<td style=\"font-size: 10px !important;\">\
                    <input type=\"number\" step=\"0.01\" style=\"font-size: 10px !important;\" class=\"form-control per_item_discount_amt\" readonly=\"true\" value=\"\"></td>");
                $(this).find('td').eq(3).after('<td><input type="text" style=\"font-size: 10px !important;\" class="form-control adjusted_price" readonly="true" value="0.00"></td>');

                var srp = $(this).find('.srp').val();
                var ap = $(this).find('.adjusted_price');
                ap.val(srp);
                //computeCart();
            }
        });
    }
}

function updateBulkForm(opt)
{
    var bulk_adj_opt = opt;
    $('.indiv_adj').each(function() {
        $(this).hide();
    });

    if (bulk_adj_opt == 'bgift') {
        $('#bulk_opt_sel').val('bgift');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        $('#cform-discount_pct').val('');
        $('#cform-selected_bulk').val('Gift');
        $('#cgroup-discount_pct').hide();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else if (bulk_adj_opt == 'bamt') {
        $('#bulk_opt_sel').val('bamt');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        $('#cform-discount_pct').val('');
        $('#cform-selected_bulk').val('Change Amount to Pay');
        $('#cgroup-discount_pct').hide();
        // $('#cform-new_total').val('');
        $('#cgroup-new_total').show();
    } else if (bulk_adj_opt == 'bdiscamt') {
        // $('#cform-discount_amount').val('');
        $('#bulk_opt_sel').val('bdiscamt');
        $('#cgroup-discount_amount').show();
        $('#cform-discount_pct').val('');
        $('#cform-selected_bulk').val('Discount Amount');
        $('#cgroup-discount_pct').hide();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else if (bulk_adj_opt == 'bdisc') {
        $('#bulk_opt_sel').val('bdisc');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        // $('#cform-discount_pct').val('');
        $('#cform-selected_bulk').val('Discount %');
        $('#cgroup-discount_pct').show();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else {
        $('#bulk_opt_sel').val('na');
        cancelBulkAdjustment();
    }
}

function clearCreditCardModal()
{
    $('#cc_form').empty();
    $("#cc_fields").clone().find("input").val("").end().appendTo('#cc_form');
}

function clearCheckModal()
{
    $('#check_form').empty();
    $("#check_fields").clone().find("input").val("").end().appendTo('#check_form');
}





function hideBulkAmounts()
{
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    $('#cform-new_total').val('');
    $('#cgroup-new_total').hide();
}

function cancelBulkAdjustment()
{
    revertOriginalPrices();
    $('#cgroup-new_total').hide();
    $('#cform-new_total').val('');
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    $('.display_price').each(function() {
        if ($(this).val() == "0" || $(this).val() == 0.00) {
            //revert prices only if bulk discount came from gift
            var row = $(this).closest('tr');
            var srp = row.find('.srp').val();
            $(this).val(srp);
        }  
    });
}



function revertOriginalPrices()
{
    $('.display_price').each(function() {
        if ($(this).val() == "0" || $(this).val() == 0.00) {
            //revert prices only if bulk discount came from gift
            var row = $(this).closest('tr');
            var srp = row.find('.srp').val();
            $(this).val(srp);
        }
        
    });
    computeCart();
    computeCartMinimum();
}

function loadFrozenTransactions()
{
    $('#frozen_list').empty();
    // $('.init_row_frozen').remove();
    // var url = "http://pos.cilanthropist.co/pos/get_frozen_transactions";
    var url = "http://pos.cilanthropist.co/pos/get_frozen_transactions";
    $.getJSON(url, function(json){  
        var count = 0;
       $.each(json, function(i, x) {
            $('.init_row_prods').remove();
            var field = '<tr class=\"row_prod_'+x.id+'\">';     
                field += '<td><input type="text" style=\"font-size: 12px !important;\" value="'+x.disp_id+'" readonly="true" class="form-control"></td>';
                field += '<td><input type="text" style=\"font-size: 12px !important;\"  class="form-control" readonly="true" value="'+x.date_created+'"></td>';  
                field += '<td ><a href="javascript:void(0)" class="btn btn-xs default green"><i class="fa fa-pencil" aria-hidden="true"></i></a></td>'; 
                field += '</tr>';

                $('#frozen_list').append(field);
       });

   });

    // var rowCount = $('#frozen_transactions tr').length-1;
    // alert(rowCount);
    //     if (rowCount == 0) {
    //         var field = '<tr class=\"init_row_frozen\">';     
    //         field += '<td colspan=\"3\"><p>No frozen transactionsss</p></td>';
    //         field += '</tr>';

    //         $('#frozen_list').append(field);
    //     }
}

function freezeTransaction()
{
    //vars
    var trans_saved = false;
    var items_saved = false;
    var payments_saved = false;
    var count_cart_items = $('#cart_items tr').length-1;
    var count_payments = $('#payments_table .init_row_payment').length;
    //refresh list of frozen transactions
    // loadFrozenTransactions();

    //save transaction
    var transaction_sys_id = $('#transaction_system_id').val();
    var transaction_disp_id = $('#transaction_display_id').val();
    var transaction_total = $('#float_trans_amount').val();
    var transaction_balance = $('#float_trans_balance').val();
    var transaction_type = $('#string_trans_type').val();

    var transaction_tax_rate = $('#float_tax_rate').val();
    var transaction_orig_vat_amt = $('#float_orig_tax_vat_amt').val();
    var transaction_new_vat_amt = $('#float_new_tax_vat_amt').val();
    var transaction_orig_vat_amt_net = $('#float_orig_tax_amt_net_vat').val();
    var transaction_new_vat_amt_net = $('#float_new_tax_amt_net_vat').val();
    var transaction_tax_coverage = $('#string_tax_coverage').val();

    var transaction_cart_min_total = $('#float_cart_minimum_total').val();
    var transaction_cart_orig_total = $('#float_cart_orig_price').val();
    var transaction_cart_new_total = $('#float_cart_new_price').val();


    var status = $('#transaction_status').val();
    var customer_id = $('#transaction_customer_id').val();

    // {id}/{display_id}/{total}/{balance}/{type}/{customer_id}/{status}/{tax_rate}/{orig_vat_amt}/{new_vat_amt}/{orig_amt_net_vat}/{new_amt_net_vat}/{tax_coverage}/{cart_min}/{orig_cart_total}/{new_cart_total}
    var url = "http://pos.cilanthropist.co/pos/save_transaction/"+transaction_sys_id+"/"+transaction_disp_id+"/"+transaction_total+"/"+transaction_balance+"/"+transaction_type+"/"+customer_id+"/"+status+"/"+transaction_tax_rate+"/"+transaction_orig_vat_amt+"/"+transaction_new_vat_amt+"/"+transaction_orig_vat_amt_net+"/"+transaction_new_vat_amt_net+"/"+transaction_tax_coverage+"/"+transaction_cart_min_total+"/"+transaction_cart_orig_total+"/"+transaction_cart_new_total;


    $.getJSON(url, function(json){  
        var count = 0;
        $.each(json, function(i, trans) {
            trans_saved = true;
            //save items
            if (count_cart_items > 0) {
                $('#cart_items tr').each(function() {
                    var row = $(this).closest('tr');
                    var product_id = row.find('.product_id').val();
                    var orig_price = row.find('.srp').val();
                    var min_price = row.find('.min_price').val();
                    var product_name = row.find('.item_name').val();
                    var discount_type = '%20';
                    var discount_value = '%20';
                    var adjusted_price = '%20';

                    if (transaction_type == "per") {
                        var indiv_disc_opt = row.find('.pos_indiv_discount_opt').val();
                        var per_item_discount_amt = row.find('.per_item_discount_amt').val();
                        var adjusted_price_elem = row.find('.adjusted_price').val();

                        if (indiv_disc_opt.length > 0) {
                            discount_type = indiv_disc_opt;
                        } else {
                            discount_type = '%20';
                        }

                        if (per_item_discount_amt.length > 0) {
                            discount_value = per_item_discount_amt;
                        } else {
                            discount_value = '%20';
                        }

                        if (adjusted_price_elem.length > 0) {
                            adjusted_price = adjusted_price_elem;
                        } else {
                            adjusted_price = '%20';
                        }
                    }
                        

                    


                    var url2 = "http://pos.cilanthropist.co/pos/save_item/"+trans.new_id+"/"+product_id+"/"+product_name+"/"+orig_price+"/"+min_price+"/"+adjusted_price+"/"+discount_type+"/"+discount_value;


                    $.getJSON(url2, function(json){  
                        var count = 0;
                        $.each(json, function(i, items) {
                            items_saved = true;
                            
                            
                        });


                    });
                });
            } else {
                items_saved = true;

                swal({
                      title: "Transaction Frozen!",
                      text: "The page will now reload",
                      type: "success",
                      confirmButtonColor: "green",
                      confirmButtonText: "Okay",
                    },
                    function(){
                      location.reload();
                    });

            }

            //save payments
            if (count_payments == 0 && transaction_type != 'none') {
                $('#payments_list tr').each(function() {
                    var payment_type = $(this).find('.payment_type').val();
                    var amount = $(this).find('.payment_amt_float').val();

                    var url3 = "http://pos.cilanthropist.co/pos/save_payment/"+trans.new_id+"/"+payment_type+"/"+amount;


                    $.getJSON(url3, function(json){  
                        var count = 0;
                        $.each(json, function(i, payments) {
                            //reload form
                            if (trans_saved && items_saved) {
                                swal({
                                      title: "Transaction Frozen!",
                                      text: "The page will now reload",
                                      type: "success",
                                      confirmButtonColor: "green",
                                      confirmButtonText: "Okay",
                                    },
                                    function(){
                                      location.reload();
                                    });
                            } else {
                                // swal('Error encountered',transaction_disp_id+' not frozen (items)','error');
                            }
                        });

                    });
                });
            } else {
                payments_saved = true;

                swal({
                      title: "Transaction Frozen!",
                      text: "The page will now reload",
                          type: "success",
                      confirmButtonColor: "green",
                      confirmButtonText: "Okay",
                    },
                    function(){
                      location.reload();
                    });

            }
        });

    });
}

function unfreezeTransaction()
{
    //clear ALL

    //load transaction

    //load items

    //load payments
}

function clearCustomerFields() 
{
    $('.cust_search_gender').prop('checked', false);
    $('#uniform-cform-cust_search_gender > span').removeClass('checked');
    $('#cform-cust_search_id').val('');
    $('#cform-cust_search_firstname').val('');
    $('#cform-cust_search_middle_name').val('');
    $('#cform-cust_search_lastname').val('');
    $('#cform-cust_search_home_phone').val('');
    $('#cform-cust_search_mobile').val('');
    $('#cform-cust_search_email').val('');
    $('#cform-cust_search_birthdate').val('');
    $('#cform-cust_search_address_1').val('');
    $('#cform-cust_search_address_2').val('');
    $('#cform-cust_search_city').val('');
    $('#cform-cust_search_state').val('');
    $('#cform-cust_search_country').val('');
    $('#cform-cust_search_zip').val('');
    $('#cform-cust_search_marriage_date').val('');
    $('#cform-notes').val('');
    $('.cust_search_marital').prop('selectedIndex',0);
    $('.posgrp_cust_search_marriage_date').hide();
}



$(document).ready(function(){ 
    ajaxGetProductCategories();  
    ajaxGetVAT();
    toastr.options = {
      "closeButton": false,
      "debug": false,
      "newestOnTop": false,
      "progressBar": true,
      "positionClass": "toast-top-right",
      "preventDuplicates": true,
      "onclick": null,
      "showDuration": "300",
      "hideDuration": "500",
      "timeOut": "4000",
      "extendedTimeOut": "500",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    }

    $('.posgrp_check_date').hide();

    $(document).on("click",".freeze_btn", function(e){
        //THIS WILL INITIATE SAVING OF TRANSACTION
        freezeTransaction();
    });

    $(document).on("click",".check_is_pdc", function(e){
        var row = $(this).closest('.check_field');
        var opt = row.find('.posgrp_check_date');
        //TO REMOVE CHECK
        //var opt = row.find('#uniform-cform-check_is_pdc > span');
        //opt.removeClass('checked');

        if ($(this).val() == 0) {
            $(this).val(1);
            opt.show();
        } else {
            $(this).val(0);
            opt.hide();
        }

        //alert($(this).val());
        
        
    });

    $('.pos_field').on('keypress', function (event) {
        var regex = new RegExp("^[a-zA-Z0-9]+$");
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if (!regex.test(key)) {
           event.preventDefault();
           return false;
        }
    });

    $('.posgrp_cust_search_marriage_date').hide();
    $('.customer_continue_btn').hide();
    $('.customer_search_again_btn').hide();

    $('.cust_search_marital').on("change", function()
    {
        var opt = $('.cust_search_marital').val();
        if (opt == 'married') {
            $('.posgrp_cust_search_marriage_date').show();
        } else {
            $('.posgrp_cust_search_marriage_date').hide();
            $('#cform-cust_search_marriage_date').val('');
        }
    });

    $(document).on("click",".customer_search_again_btn", function(e){
        clearCustomerFields();
        $('.customer_seach_main_div').show();
        $('.customer_search_btn').show();
        $('.customer_clear_search_btn').show();
        $('.add_customer').show();
        $('.customer_continue_btn').hide();
        $('.customer_search_again_btn').hide();
    });

    $(document).on("click",".customer_continue_btn", function(e) {
        swal("Success!", 'Customer selected!',"success");
        $('#customer_modal').modal('hide');
        if ($('#string_trans_type').val() != 'none' && parseFloat($('#float_trans_balance').val()) <= 0) {
            $('#final_modal').modal('show');
        }
    }); 

    $(document).on("click",".cancel_cust_search", function(e){
        clearCustomerFields();
        $('#customer_modal').modal('hide');
        $('.customer_seach_main_div').show();
        $('.customer_search_btn').show();
        $('.customer_clear_search_btn').show();
        $('.add_customer').show();
        $('.customer_continue_btn').hide();
        $('.customer_search_again_btn').hide();
    });


    $(document).on("click",".use_customer_btn", function(e){
        clearCustomerFields();
        $('#customers_list').empty();
        $('.customer_seach_main_div').hide();
        $('.customer_search_btn').hide();
        $('.customer_clear_search_btn').hide();
        $('.add_customer').hide();
        $('.customer_continue_btn').show();
        $('.customer_search_again_btn').show();

        var row = $(this).closest('tr');
        var opt = row.find('.marital_status').val();
        if (opt == 'married') {
            $('.posgrp_cust_search_marriage_date').show();
        } else {
            $('.posgrp_cust_search_marriage_date').hide();
            $('#cform-cust_search_marriage_date').val('');
        }

        $('#transaction_customer_id').val(row.find('.id').val());

        $('#cform-cust_search_id').val(row.find('.id').val());
        $('#cform-cust_search_firstname').val();
        $('#cform-cust_search_middle_name').val(row.find('.middle_name').val());
        $('#cform-cust_search_lastname').val(row.find('.last_name').val());
        $('#cform-cust_search_home_phone').val(row.find('.home_phone').val());
        $('#cform-cust_search_mobile').val(row.find('.number').val());
        $('#cform-cust_search_email').val(row.find('.email').val());
        $('#cform-cust_search_birthdate').val(row.find('.birthdate').val());
        $('#cform-cust_search_address_1').val(row.find('.address1').val());
        $('#cform-cust_search_address_2').val(row.find('.address2').val());
        $('#cform-cust_search_city').val(row.find('.city').val());
        $('#cform-cust_search_state').val(row.find('.state').val());
        $('#cform-cust_search_country').val(row.find('.country').val());
        $('#cform-cust_search_zip').val(row.find('.zip').val());
        $('#cform-cust_search_marriage_date').val(row.find('.date_married').val());
        $('#cform-cust_search_notes').val(row.find('.notes').val());
        $('.cust_search_marital').val(row.find('.marital_status').val());
        $('#uniform-cform-cust_search_gender > span').each(function() {
            if ($(this).find('#cform-cust_search_gender').val() == row.find('.gender').val()) {
                $(this).addClass('checked');
            }
        });

        var objDiv = document.getElementById("cust_formx");
        objDiv.scrollTop = 0;
    });


    $(document).on("click",".customer_clear_search_btn", function(e){
        clearCustomerFields();
    });

    // CC



    /* Fancy restrictive input formatting via jQuery.payment library*/
    $('input[name=cc_card_number]').payment('formatCardNumber');
    $('input[name=cc_card_cvv]').payment('formatCardCVC');
    $('input[name=cc_card_expiry').payment('formatCardExpiry');

    /* Form validation using Stripe client-side validation helpers */
    jQuery.validator.addMethod("cc_card_number", function(value, element) {
        return this.optional(element) || Stripe.card.validateCardNumber(value);
    }, "Please specify a valid credit card number.");

    jQuery.validator.addMethod("cc_card_expiry", function(value, element) {    
        /* Parsing month/year uses jQuery.payment library */
        value = $.payment.cardExpiryVal(value);
        return this.optional(element) || Stripe.card.validateExpiry(value.month, value.year);
    }, "Invalid expiration date.");

    jQuery.validator.addMethod("cc_card_cvv", function(value, element) {
        return this.optional(element) || Stripe.card.validateCVC(value);
    }, "Invalid CVC.");


    // END CC



    // CLEAN
    $('.updated_totals_row').hide();

    $(document).on("click",".remove_row", function(e){
        var trans_type = $('#string_trans_type').val();

        if (trans_type == 'bulk') {
            sweetAlert("Can't remove item!", "Reset transaction type to remove item/s", "error");
        } else {
            e.preventDefault();            
            var tr = $(this).closest('tr');
            tr.remove();

            //count number of products in cart
            var rowCount = $('#cart_table tr').length-1;
            $('.cart_items_count').text(rowCount.toString());

            if (rowCount == 0) {
                var field = '<tr class=\"init_row_prods\">';     
                field += '<td colspan=\"3\" class=\"xrow\"><p>No items added</p></td>';
                field += '</tr>';

                $('#cart_items').prepend(field);
            }

            if($('#string_trans_type').val() == 'none' || $('#string_trans_type').val() == 'reg') {
                computeCartRaw();
            } else if($('#string_trans_type').val() == 'per') {
                // alert('remove indiv');
                computeCartRaw();
                computeCartIndiv();
            } else if($('#string_trans_type').val() == 'bulk') {
                computeCartRaw();
                applyBulkAdjustment();
            } else {
                computeCartRaw();
            }
            computeBalance();    
        }
        
        return false;
    });

    $(document).on("click",".cp_customers", function(e){
        $('#customer_modal').modal('show');
    });

    $(document).on("click",".customer_search_btn", function(e){
        var objDiv = document.getElementById("cust_formx");
        objDiv.scrollTop = objDiv.scrollHeight;
        ajaxSearchCustomer();
    });

    $(document).on("click",".save_customer_button", function(e){
        ajaxAddCustomer();
    });

    $(document).on("click",".add_customer", function(e){
        $('#customer_modal').modal('hide');
        $('#add_customer_modal').modal('show');
    });

    $(document).on("click",".cp_quotation", function(e){
        if ($('#string_trans_mode').val() == 'normal') {
            $('#quotation_modal').modal('show');
        } else {
            $('#rev_quotation_modal').modal('show');
        }
    });

    $(document).on("click",".cp_freeze", function(e){
        loadFrozenTransactions();
        $('#freeze_modal').modal('show');
    });

    $(document).on("click",".quotation_continue_btn", function(e){
        if ($('#string_trans_mode').val() == 'normal') {
            $('#string_trans_mode').val('quotation');
            $('#pos_mode').text('Quotation');
            $('.quotation_icon_img').attr("src", "{{ asset('bundles/gisttemplate/assets/global/img/quote.png') }}");
            // toastr['success']('Quotation mode enabled.', 'POS Mode Changed');
            swal("POS Mode Changed", "Quotation mode enabled!", "success")
            $('#quotation_modal').modal('hide');
        } else {
            $('#string_trans_mode').val('normal');
            $('#pos_mode').text('Normal');
            $('.quotation_icon_img').attr("src", "{{ asset('bundles/gisttemplate/assets/global/img/normal.png') }}");
            // toastr['success']('Quotation mode disabled.', 'POS Mode Changed');
            swal("POS Mode Changed", "Quotation mode disabled!", "success")
            $('#rev_quotation_modal').modal('hide');
        }
        
    });
    

    


    $(document).on("click",".next_step_btn", function(e){
        if ($('#cart_table tr').length > 1 && $('#cart_table .xrow').length == 0) {
            $('#transaction_type_modal').modal('show');
        } else {
            toastr['warning']('Add products to cart before proceeding to next step.', 'Warning');
        }
    });



    $(document).on("click",".clear_discount", function(e){
        revertDiscounts();
        $('.customer_savings').text("0.00");
        $('.savings_h4').hide();
    });

    $('#cform-indiv_adj').on("change", function()
    {
        var indiv_adj_opt = $('#cform-indiv_adj').val();
        if (indiv_adj_opt == 'chg') {
            $('#cform-new_price').val('');
            $('#cgroup-new_price').show();
        } else {
            $('#cgroup-new_price').hide();
            $('#cform-new_price').val('');
        }
    });

    // $("#cform-discount_pct").keyup(function() {
    //     $("#cform-discount_pct").val(this.value.match(/[0-9]*/));
    // });

    $(document).on('keydown', '#cform-discount_pct', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });



    // $("#cform-discount_amount").keyup(function() {
    //     $("#cform-discount_amount").val(this.value.match(/[0-9]*/));
    // });

    $(document).on('keydown', '#cform-discount_amount', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    // $("#cform-new_price").keyup(function() {
    //     $("#cform-new_price").val(this.value.match(/[0-9]*/));
    // });

    $(document).on('keydown', '#cform-new_price', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    $(document).on("click",".bulk_adj", function(e){
        $('#bulk_adjustment').modal('show');
    });

    $(document).on('keydown', '.per_item_discount_amt', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    $('#final_modal').on('hidden', function () {
        location.reload();
    });

    $(document).on('keyup', '.per_item_discount_amt', function () {
        var row = $(this).closest('tr');
        var srp = row.find('.srp').val();
        var input_amt = $(this).val();
        var adjusted_price = row.find('.adjusted_price');
        var per_item_discount_amt = row.find('.per_item_discount_amt');
        var pos_indiv_discount_opt = row.find('.pos_indiv_discount_opt').val();

        if (pos_indiv_discount_opt == 'disc') {
            if (parseFloat(input_amt) > 100) {
                toastr['error']('Discount percentage exceeded.', 'Error');
                $(this).val(100);
            }
            var discounted_price = srp - (srp * (input_amt/100));
            adjusted_price.val(discounted_price);
        } else if (pos_indiv_discount_opt == 'discamt') {
            if (input_amt < 0 || input_amt == '') {
                var discounted_price = parseFloat(srp);
                adjusted_price.val(discounted_price);
            } else {
                var discounted_price = parseFloat(srp) - parseFloat(input_amt);
                adjusted_price.val(discounted_price);
            }
        } else if (pos_indiv_discount_opt == 'chg') {
            adjusted_price.val(input_amt);
        }
        
        computeCartIndiv();
        computeCartMinimum();
        computeBalance();

    });

    $(document).on("click",".finish_btn", function(e){
        var balance = $('#float_trans_balance').val();
        if (balance <= 0) {
            swal("Payment Complete!", "Enter customer information on the next form", "success")
            $('#checkout_modal').modal('hide');
            $('#customer_modal').modal('show');
        } else {
            if ($('#string_trans_mode').val() == "quotation") {
                swal("Payment Complete!", "Enter customer information on the next form", "success")
                $('#checkout_modal').modal('hide');
                $('#customer_modal').modal('show');
            } else {
                // toastr['error']('Balance of '+addCommas(parseFloat(balance))+' not paid', 'Transaction incomplete');
                sweetAlert("Oops...", "Balance of "+addCommas(parseFloat(balance))+" not paid", "error");
            }
        }
    });

    $(document).on("click",".apply_bulk", function(e){
        applyBulkAdjustment();
    });

    $(document).on("click",".view_cart_btn", function(e){
        $('#cart_a').click();
    });

    $(document).on("click",".category_btn", function(e){

        $('.category_btn').each(function() {
            $(this).css({'background-color': '#556E93'});
        });
        $('#products_a').click();
        $('#selected_pcat').text(' - '+$(this).html());
        $(this).css({'background-color': '#484c50'});
    });

    $(document).on('keydown', '#cform-cash_received_amt', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    $(document).on('keydown', '.cc_charge_amt', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    $(document).on('keydown', '.check_amount', function (event) {
        if (event.shiftKey == true) {
            event.preventDefault();
        }

        if ((event.keyCode >= 48 && event.keyCode <= 57) || 
            (event.keyCode >= 96 && event.keyCode <= 105) || 
            event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
            event.keyCode == 39 || event.keyCode == 46 || event.keyCode == 190 || event.keyCode == 110) {

        } else {
            event.preventDefault();
        }

        if($(this).val().indexOf('.') !== -1 && (event.keyCode == 190 || event.keyCode == 110))
            event.preventDefault(); 
        //if a decimal has been added, disable the "."-button

    });

    $(document).on('keyup', '.cc_charge_amt', function (event) {
        computeBalanceDisplayCardMulti();
    });

    $(document).on('keyup', '.check_amount', function (event) {
        computeBalanceDisplayCheckMulti();
    });

    $(document).on('keyup', '#cform-cash_received_amt', function () {
        // $(this).val(this.value.match(/[0-9]*/));
        if ($(this).val() != '') {
            var amt_to_pay = $('#float_trans_balance').val();
            var chg_amt = parseFloat($(this).val()) - parseFloat(amt_to_pay);
            if (chg_amt >= 0) {
                var change = chg_amt;  
                $('#cash_chg_amt').text(addCommas(change));  
            } else {
                var change = '0.00';
                $('#cash_chg_amt').text(change);
            }

            computeBalanceDisplay($(this).val());
            
        } else {
            $('#cash_chg_amt').text("0.00");
        }
        

    });

    // $(document).on('keyup', '.cc_charge_amt', function () {
    //     $(this).val(this.value.match(/[0-9]*/));
    // });

    $(document).on("click",".numeric_key", function(e){
        if ($(this).data("value") == 'CLEAR') {
            $('#cform-cash_received_amt').val("");
            $('#cash_chg_amt').text(0.00);
        } else if ($(this).data("value") == 'DEL') {
            var str = $('#cform-cash_received_amt').val();
            $('#cform-cash_received_amt').val(str.substring(0, str.length - 1));
            var amt_to_pay = $('#float_trans_balance').val();
            var chg_amt = parseFloat($('#cform-cash_received_amt').val()) - amt_to_pay;
            if (chg_amt >= 0) {
                var change = chg_amt;  
                $('#cash_chg_amt').text(addCommas(change));  
            } else {
                var change = '0.00';
                $('#cash_chg_amt').text(change);
            }
            $('#cash_chg_amt').text(addCommas(change));
        } else {
            if($('#cform-cash_received_amt').val().indexOf('.') !== -1 && ($(this).data("value") == '.')) {
                e.preventDefault();
            } else {
                $('#cform-cash_received_amt')[0].value += $(this).data("value");
                var amt_to_pay = $('#float_trans_balance').val();
                var chg_amt = parseFloat($('#cform-cash_received_amt').val()) - amt_to_pay;
                if (chg_amt >= 0) {
                    var change = chg_amt;  
                    $('#cash_chg_amt').text(addCommas(change));  
                } else {
                    var change = '0.00';
                    $('#cash_chg_amt').text(change);
                }
            }
        }

        computeBalanceDisplay($('#cform-cash_received_amt').val());
    });

    

    $(window).keydown(function(event){
        if(event.keyCode == 13) {
          event.preventDefault();
          return false;
        }
    });


    $(document).on("click",".cash_proceed_btn", function(e){
        var payment_amt = $('#cform-cash_received_amt').val();
        if (payment_amt > 0) {
            addToPayments('Cash', parseFloat(payment_amt));
            $('#cash_modal').modal('hide');
            $('#cform-cash_received_amt').val('');
            $('#checkout_modal').modal('show');
        } else {
            toastr['error']('Invalid payment amount.', 'Error');
        }
        
    });

    $(document).on("click",".card_proceed_btn", function(e){
        $('.cc_field').each(function() {
            var cc_number = $(this).find('#cform-cc_card_number').val();
            var cc_name = $(this).find('#cform-cc_card_name').val();
            var payment_amt = $(this).find('#cform-cc_charge_amt').val(); 
            var cc_bank = $(this).find('#cform-cc_bank').val(); 
            if (cc_number != '' && payment_amt != '') {
                if (payment_amt > 0) {
                    var cc_details = cc_number + "," + cc_name + "," + cc_bank;
                    // var arrString = JSON.stringify(cc_details);

                    addToPayments('Credit Card', parseFloat(payment_amt), cc_details);
                    $('#cc_modal').modal('hide');
                    clearCreditCardModal();
                    $('#checkout_modal').modal('show');
                } else {
                    toastr['error']('Invalid payment amount.', 'Error');
                }
            } else {

            }
        });
    });

    $(document).on("click",".check_proceed_btn", function(e){
        $('.check_field').each(function() {
            var check_number = $(this).find('#cform-check_number').val();
            // var cc_name = $(this).find('#cform-cc_card_name').val();
            var payment_amt = $(this).find('#cform-check_amount').val(); 
            // var cc_bank = $(this).find('#cform-cc_bank').val(); 
            if (check_number != '' && payment_amt != '') {
                if (payment_amt > 0) {
                    // var cc_details = cc_number + "," + cc_name + "," + cc_bank;
                    // var arrString = JSON.stringify(cc_details);

                    addToPayments('Check', parseFloat(payment_amt));
                    $('#check_modal').modal('hide');
                    clearCheckModal();
                    $('#checkout_modal').modal('show');
                } else {
                    // toastr['error']('Invalid payment amount.', 'Error');
                }
            } else {

            }
        });
    });

    $(document).on("click",".remove_customer", function(e){
        e.preventDefault();            
        var tr = $(this).closest('tr');
        tr.remove();
        return false;

    });

    $(document).on("click",".remove_payment_row", function(e){
        e.preventDefault();            
        var tr = $(this).closest('tr');
        tr.remove();

        //count number of payments in list
        var rowCount = $('#payments_table tr').length-1;

        if (rowCount == 0) {
            var field = '<tr class=\"init_row_payment\">';     
            field += '<td colspan=\"3\"><p>No payments added</p></td>';
            field += '</tr>';

            $('#payments_table').prepend(field);
        }

        computeBalance();
        toastr['success']('Payment removed', 'Success');
        return false;
    });

    $(document).on("click",".add_card_btn", function(e){
        $("#cc_fields").clone().find("input").val("").end().appendTo('#cc_form');
        $('input[name=cc_card_number]').payment('formatCardNumber');
        $('input[name=cc_card_cvv]').payment('formatCardCVC');
        $('input[name=cc_card_expiry').payment('formatCardExpiry');

        var objDiv = document.getElementById("cc_form");
        objDiv.scrollTop = objDiv.scrollHeight;

        return false;
    });

    $(document).on("click",".add_check_btn", function(e){
        $("#check_fields").clone().find("input").val("").end().appendTo('#check_form');
        var objDiv = document.getElementById("check_form");
        objDiv.scrollTop = objDiv.scrollHeight;
        return false;
    });

    $(document).on("click",".checkout_btn", function(e){
        if ($('#cart_table tr').length > 1) {
            $('#checkout_modal').modal('show');
            var rowCount = $('#payments_table tr').length-1;
            if (parseFloat($('#float_trans_balance').val()) == 0 && rowCount == 0) {
                $('.co_amt_to_pay').text($('#transaction_amt_to_pay').val());
                $('.co_balance').text($('#transaction_amt_to_pay').val());
            } else {
                $('.co_amt_to_pay').text($('#transaction_amt_to_pay').val());
            }
        } else {
            toastr['warning']('Add products to cart before proceeding to next step.', 'Warning');
        }
        
    });

    // $('input[type=radio][name=check_type]').change(function() {
    //     alert(this.value);
    // });

    // END CLEAN

    // $('.check_date_main_div').hide();


    //$('#cgroup-app_code').hide();
    $('.bulk_adj').hide();
    $('.clear_discount').hide();
    $('.checkout_btn').hide();
    $('.orig_totals_row').hide();
    $('.orig_price_h3').hide();
    $('.bulk_discount_h4').hide();
    $('.savings_h4').hide();
    

    $('#cform-new_price').val('');
    $('#cgroup-new_price').hide();
    hideBulkAmounts();





    $(document).on("click",".co_cash_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#cash_modal').modal('show');
    });

    $(document).on("click",".co_cc_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#cc_modal').modal('show');
    });

    $(document).on("click",".co_check_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#check_modal').modal('show');
    });

    
    $(document).on("click",".cash_go_back", function(e){
        $('#cform-cash_received_amt').val('');
        $('#cash_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    $(document).on("click",".cc_go_back", function(e){
        clearCreditCardModal();
        $('#cc_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    $(document).on("click",".check_go_back", function(e){
        clearCheckModal();
        $('#check_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    //Proceed
    $(document).on("click",".proceed_btn", function(e){
        proceedToTransaction();
    });
});
</script>
{% endblock %}