{% extends "GistTemplateBundle::base.html.twig" %}
{% import "GistTemplateBundle::form.html.twig" as form_tools %}
{% block content %}
<!-- CART VARS -->
<input type="hidden" id="float_cart_minimum_total" value="0">
<input type="hidden" id="float_cart_orig_price" value="0">
<input type="hidden" id="float_cart_new_price" value="0">
<!-- END CART VARS -->
<!-- TRANSACTION VARS -->
<input type="hidden" id="float_trans_amount" name="transaction_amt_to_pay" value="0">
<input type="hidden" id="float_trans_balance" name="transaction_balance" value="0">
<input type="hidden" id="string_trans_type" value="none">
<!-- END TRANSACTION VARS -->
<!-- TAX VARS -->
<input type="hidden" id="float_tax_rate" value="0">
<input type="hidden" id="float_orig_tax_vat_amt" value="0">
<input type="hidden" id="float_new_tax_vat_amt" value="0">
<input type="hidden" id="float_orig_tax_amt_net_vat" value="0">
<input type="hidden" id="float_new_tax_amt_net_vat" value="0">
<input type="hidden" id="string_tax_coverage" value="{{tax_coverage|default('none')}}">
<input type="hidden" id="float_orig_excl_total" value="0">
<input type="hidden" id="float_new_excl_total" value="0">
<!-- END TAX VARS -->
<!-- OLD VARS -->
<input type="hidden" id="session_vat" name="session_vat" value="0">
<input type="hidden" id="cart_min_price" name="cart_min_price" value="0">
<input type="hidden" id="cart_int_price" name="cart_int_price" value="0">
<input type="hidden" id="float_cart_orig_price" name="float_cart_orig_price" value="0">
<input type="hidden" id="transaction_amt_to_pay" name="transaction_amt_to_pay" value="0">
<input type="hidden" id="transaction_balance" name="transaction_balance" value="0">
<input type="hidden" id="reg_trans_flag" name="reg_trans_flag" value="0">
<input type="hidden" id="bulk_opt_sel" name="bulk_opt_sel" value="">
<input type="hidden" id="tax_coverage" name="tax_coverage" value="{{tax_coverage|default('none')}}">
<!-- END OLD VARS -->
<div class="page-content">
    <br>
    <div class="row" style="margin-right: 0px !important;">
        <div class="col-md-2" style="padding-right: 1px !important; border: 0px !important;">
        	<div class="portlet box " style="background-color: #292929 !important;border: 0px !important;">
                <div class="portlet-title">
                    <div class="caption">Product Categories</div>
                </div>
                <div class="portlet-body form" id="prod_cats" style="height: 400px; overflow:scroll;overflow-x: hidden;">
                	
                </div>
            </div>
        </div>
        <div class="col-md-10" style="padding-right: 1px !important; padding-left: 5px !important;">
            <div class="portlet box tabbable" style="background-color: #292929 !important;border: 0px !important;"> 
                <div class="portlet-title">
                    <div class="caption"><i class="icon-reorder"></i>&nbsp;</div>
                </div>
                <div class="portlet-body">
                    <div class="tabbable portlet-tabs">
                        <ul class="nav nav-tabs">
                            <li><a href="#cart_tab" data-toggle="tab">Cart</a></li>
                            <li class="active"><a href="#products_tab" data-toggle="tab">Products</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="products_tab">
                                <br>
                                <div  style="height: 370px;overflow:scroll; overflow-x: hidden;">
                                <div class="row" id="prods">
                                    
                                </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="cart_tab">
                                <div style="overflow:scroll; overflow-x: hidden; height: 300px;">
                                <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="cart_table">
                                    <thead>
                                        <tr>
                                            <th width="60%">Item</th>
                                            <th width="25%">Price</th>
                                            <th width="10%"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="cart_items">

                                    </tbody>
                                </table>
                                </div>
                                
                                <div class="row">
                                {#{{ form.group_text('Approval Code', 'app_code', '', 4, 2, false) }}#}
                                </div>
                                <br>
                                
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <a href="javascript:void(0)" class="btn next_step_btn" style="background-color: #556E93; color: #ffffff;">Next Step</a>
                                        <a href="javascript:void(0)" class="btn bulk_adj" style="background-color: #556E93; color: #ffffff;">Bulk Discount</a>
                                        <a href="javascript:void(0)" class="btn checkout_btn" style="background-color: green; color: #ffffff;">Checkout</a>
                                        <a href="javascript:void(0)" class="btn clear_discount" style="background-color: orange; color: #ffffff;">Reset Transaction Type</a>
                                        <a href="" class="btn" style="background-color: red; color: #ffffff;">Clear Cart</a>
                                        <br>
                                        <br>
                                        <h4 class="bulk_discount_h4">Bulk Discount: <b><span id="applied_bulk_discount" value="">None</span></b></h4>
                                        <h4 class="savings_h4">You saved: <b><span id="customer_savings" value=""></span></b></h4>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-striped table-bordered table-hover" style="margin-top: 20px;" id="cart_totals_table">
                                            <thead>
                                                <tr>
                                                    <th width="40%"></th>
                                                    <th width="30%">Amount Net of VAT</th>
                                                    <th width="30%">VAT</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="orig_totals_row">
                                                    <td><p style="font-size:12px;" class="orig_price_h3">Original Total: <b>Php <span id="cart_orig_price" value="0">0</span></b></p></td>
                                                    <td><p style="font-size:12px;" class="orig_amt_vat"><b>Php <span id="cart_orig_amt_vat" value="0">0</span></b></p></td>
                                                    <td><p style="font-size:12px;" class="orig_vat"><b>Php <span id="cart_orig_vat" value="0">0</span></b></p></td>
                                                </tr>
                                                <tr class="initial_totals">
                                                    <td><p style="font-size:12px;" class="cart_price_h3">Total: <b>Php <span class="initial_cart_price" value="0">0</span></b></p></td>
                                                    <td><p style="font-size:12px;" class="new_amt_vat"><b>Php <span id="initial_amt_net_vat" value="0">0</span></b></p></td>
                                                    <td><p style="font-size:12px;" class="new_vat"><b>Php <span id="initial_vat_amt" value="0">0</span></b></p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="margin-right: 0px !important;">
        <div class="col-md-3" >
            <div class="alert" style="background-color: #eaeaea !important; border-color: #d6e9c6 !important; color: #000000 !important;"> 
                <p style="font-size:18px;">&nbsp;Number of items: <b><span style="margin-right: 0px;" class="cart_items_count" value="0">0</span></b></p>
            </div>
        </div>
        <div class="col-md-4" >
            <div class="alert" style="background-color: #eaeaea !important; border-color: #d6e9c6 !important; color: #000000 !important;"> 
                <p style="font-size:18px;">&nbsp;Transaction Total: <b>Php <span style="margin-right: 15px;" class="transaction_total" value="0">0</span></b><a href="javascript:void(0)">View Cart</a></p>
            </div>
        </div>
        <div class="col-md-5" >
            <div class="alert" style="background-color: #eaeaea !important; border-color: #d6e9c6 !important; color: #000000 !important;"> 
                
            </div>
        </div>
    </div>

    <div id="bulk_adjustment" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Bulk Discount Form</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-3" class="proceed_btn_reg" onclick="updateBulkForm('bgift')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk1.png') }}"></a>
                                <h4>Gift</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_per"  onclick="updateBulkForm('bdisc')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk2.png') }}"></a>
                                <h4>Discount %</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_bulk"  onclick="updateBulkForm('bdiscamt')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk3.png') }}"></a>
                                <h4>Discount</h4>
                            </div>
                            <div class="col-md-3" class="proceed_btn_bulk"  onclick="updateBulkForm('bamt')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk4.png') }}"></a>
                                <h4>Amount to Pay</h4>
                            </div>
                            <div style="margin-bottom: 15px;"></div>
                            {{ form.group_text('New Price', 'new_total', '', 3, 4, false) }}
                            {{ form.group_text('Discount Amount', 'discount_amount', '', 3, 4, false) }}
                            {{ form.group_text('Discount %', 'discount_pct', '', 3, 4, false) }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green apply_bulk" data-dismiss="modal" style="margin=0" href="javascript:void(0)">Apply</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="transaction_type_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Select Transaction Type</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-4" class="proceed_btn_reg" onclick="proceedToTransaction('reg')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/regular_trans.png') }}"></a>
                                <h4>Regular Transaction</h4>
                            </div>
                            <div class="col-md-4" class="proceed_btn_per"  onclick="proceedToTransaction('per')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/per_trans.png') }}"></a>
                                <h4>Per Item Discount</h4>
                            </div>
                            <div class="col-md-4" class="proceed_btn_bulk"  onclick="proceedToTransaction('bulk')">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/bulk_trans.png') }}"></a>
                                <h4>Bulk Discount</h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green proceed_btn" style="margin=0" href="javascript:void(0)">Proceed</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="checkout_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Checkout & Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay" value="0">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance" value="0">0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-12">
                                <hr>
                            </div>
                        </div>
                        <div class="row form-horizontal form">
                            <div class="col-md-3" class="" onclick="">
                                <a href="javascript:void(0)" class="co_cash_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_cash.png') }}"></a>
                                <h4>Cash</h4>
                            </div>
                            <div class="col-md-3" class=""  onclick="">
                                <a href="javascript:void(0)" class="co_cc_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_card.png') }}"></a>
                                <h4>Card</h4>
                            </div>
                            <div class="col-md-3" class=""  onclick="">
                                <a href="javascript:void(0)" class="co_check_payment"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_check.png') }}"></a>
                                <h4>Check</h4>
                            </div>
                            <div class="col-md-3" class=""  onclick="">
                                <a href="javascript:void(0)"><img src="{{ asset('bundles/gisttemplate/assets/global/img/pay_gc.png') }}"></a>
                                <h4>Gift Card</h4>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green proceed_btn" style="margin=0" href="javascript:void(0)">Finish</a>
                        <button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="cash_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Cash Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 20px;">
                            <div class="col-md-12">
                                {{ form.group_text('Received Amount', 'cash_received_amt', '', 4, 4, false) }}
                                <div class="row">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="7">7</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="8">8</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="9">9</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="4">4</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="5">5</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="6">6</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="1">1</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="2">2</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="3">3</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important; margin-bottom: 10px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn btn-lg default white" style="color: white !important; background-color: white !important; cursor: default !important;">0</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default blue numeric_key" data-value="0">0</a>
                                        <a href="javascript:void(0)" class="btn btn-lg default white" style="color: white !important; background-color: white !important; cursor: default !important;">0</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 5px !important; margin-bottom: 10px !important;">
                                    <div class="col-md-4">
                                    </div>
                                    <div class="col-md-4">
                                        <a href="javascript:void(0)" class="btn default red numeric_key" data-value="CLEAR">Clear</a>
                                        <a href="javascript:void(0)" class="btn default red numeric_key" data-value="DEL">Delete</a>
                                    </div>
                                    <div class="col-md-4">
                                    </div>
                                </div>
                                {{ form.group_text('Change Amount', 'cash_chg_amt', '0.00', 4, 4, true) }}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green cash_proceed_btn" style="margin=0" href="javascript:void(0)">Proceed</a>
                        <a class="btn default cash_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                        {#<button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>#}
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="cc_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Card Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 20px;">
                            <div class="col-md-12">
                                {{ form.group_select('Terminal Operator', 'cc_terminal_operator', terminal_operators, '', 4, 4, false) }}
                                {{ form.group_text('Charge Amount', 'cc_charge_amt', '', 4, 4, false) }}
                                {{ form.group_select('Bank', 'cc_bank', bank_options, '', 4, 4, false) }}
                                {{ form.group_text('Credit Card Number', 'cc_card_number', '', 4, 4, false) }}
                                {{ form.group_text('Name on Card', 'cc_card_name', '', 4, 4, false) }}
                                {{ form.group_text('Expiration Date (MM/YY)', 'cc_card_expiry', '', 4, 4, false) }}
                                {{ form.group_text('CVV', 'cc_card_cvv', '', 4, 4, false) }}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green cash_proceed_btn" style="margin=0" href="javascript:void(0)">Proceed</a>
                        <a class="btn default cc_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                        {#<button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>#}
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="check_modal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" action="">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true"></a>
                        <h4 id="form_title" class="modal-title">Check Payment</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row form-horizontal form">
                            <div class="col-md-6">
                                <h4>Amount to pay <b>Php <span class="co_amt_to_pay">0.00</span></b></h4>
                            </div>
                            <div class="col-md-6">
                                <h4>Balance <b>Php <span class="co_balance" >0.00</span></b></h4>
                            </div>
                        </div>
                        <div class="row form-horizontal form" style="margin-top: 20px;">
                            <div class="col-md-12">
                                {{ form.group_select('Bank', 'check_bank', bank_options, '', 4, 4, false) }}
                                {{ form.group_text('Bank Code', 'check_bank_code', '', 4, 4, false) }}
                                {{ form.group_text('Account Number', 'check_account_number', '', 4, 4, false) }}
                                {{ form.group_text('Check Number', 'check_number', '', 4, 4, false) }}
                                {{ form.group_date('Check Date','check_date', '',4,4) }}
                                {{ form.group_text("Payee's Name", 'check_payee_name', '', 4, 4, false) }}
                                {{ form.group_text('Check Amount', 'check_amount', '', 4, 4, false) }}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="btn default green cash_proceed_btn" style="margin=0" href="javascript:void(0)">Proceed</a>
                        <a class="btn default check_go_back" style="margin=0" href="javascript:void(0)">Go Back</a>
                        {#<button type="button" data-dismiss="modal" class="btn default" data-toggle="modal">Cancel</button>#}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script>
function ajaxGetProductCategories()
{
    $( "#prod_cats" ).empty();
    $( "#prods" ).empty();
    $("#prod_cats").append("<div style=\"height: 10px;\">");
    var url = "http://dev.gisterp2/inventory/pos/get/product_categories";
    // var url = "http://erp.cilanthropist.co/inventory/pos/get/product_categories";
    $.getJSON(url, function(json){  
       $.each(json, function(i, item) {
            var img = "http://nahmdong.com/vitalhill/img/default.png";
            if (item.image_url != null) {
                img = item.image_url;
            }
            // alert(item.name);
            $("#prod_cats").append("<button class=\"btn btn-md btn-block category_btn\" id=\"cat_btn_"+item.id+"\" onclick=\"ajaxGetProducts("+item.id+")\" style=\"background-color: #556E93; color: #ffffff; border-radius: 5px !important;\">"+item.name+"</button>");

            $("#prods").append("<div class=\"col-md-2\" style=\"margin: 0px !important; padding: 1px !important\" >\
                    <a href=\"javascript:void(0)\" class=\"category_btn2\" style=\"text-decoration: none;\" onclick=\"ajaxGetProducts("+item.id+")\">\
                    <div class=\"thumbnail\" style=\"margin: 0px !important;border-width: 1px !important; border-color: #5d5d5d !important; border-radius: 5px !important;\">\
                        <img src="+img+" style=\"height: 90px; width: 60%; display: block;\">\
                        <div class=\"caption\" style=\"font-size: 10px !important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">\
                            <h3 style=\"font-size: 10px !important; margin: 0!important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">"+item.name+"</h3>\
                        </div>\
                    </div>\
                    </a>\
                </div>");
        });
    });
}

function ajaxGetProducts(cid)
{

    $( "#prods" ).empty();
    $("#prods").append("<div class=\"col-md-12\"><h2>&nbsp;&nbsp;&nbsp;Loading products...</h2></div>");
    $("#cat_btn_"+cid).css({'background-color': '#484c50'});
    $( "#prods" ).empty();
    
    var url = "http://dev.gisterp2/inventory/pos/get/products/"+cid;
    // var url = "http://erp.cilanthropist.co/inventory/pos/get/products/"+cid;
    $.getJSON(url, function(json){  
        var count = 0;
       $.each(json, function(i, item) {
        count++;
        var price = 0;
        if (item.srp != null) {
            price = item.srp;
        } 

        var img = "http://nahmdong.com/vitalhill/img/default.png";
        if (item.image_url != null) {
            img = item.image_url;
        }

            $("#prods").append("<div class=\"col-md-2\" style=\"margin: 0px !important; padding: 2px !important\" >\
                    <a href=\"javascript:void(0)\" style=\"text-decoration: none;\" onclick=\"addToCart('"+item.name+"',"+price+","+item.min_price+","+item.id+")\">\
                    <div class=\"thumbnail\" style=\"margin: 0px !important; border-width: 1px !important; border-color: #5d5d5d !important; border-radius: 5px !important;\">\
                        <img src="+img+" style=\"height: 90px; width: 60%; display: block;\">\
                        <div class=\"caption\" style=\"font-size: 10px !important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">\
                            <h3 style=\"font-size: 10px !important; margin: 0!important; text-overflow: ellipsis !important; white-space: nowrap; overflow: hidden;\">"+item.name+"</h3>\
                            <h3 style=\"font-size: 12px !important; margin: 0!important;\"><b>PHP "+price+"</b></h3>\
                        </div>\
                    </div>\
                    </a>\
                </div>");

        });

       if (count == 0) {
            $( "#prods" ).empty();
            $("#prods").append("<div class=\"col-md-12\"><div class=\"alert alert-warning\"> <h2>&nbsp;&nbsp;No products in selected category</h2></div></div>");
       }
    });
}

// sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
function addCommas(nStr)
{
    if (nStr != "" && parseFloat(nStr) > 0) {
        nStr = nStr.toFixed(2);
        nStr += '';
        x = nStr.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }

        var ret_val = x1+x2;
        return ret_val;
    } else {
        return "0.00";
    }
}

function ajaxGetVAT()
{
    var url = "http://erp.cilanthropist.co/inventory/pos/get/vat";
    var vat = 0;
    $.getJSON(url, function(json){  
        $('#float_tax_rate').val(json)
    });
}

function addToCart(product_name, srp, min_price, id)
{
    var row_id = Math.round(new Date().getTime() + (Math.random() * 100));
    var field = '<tr class=\"row_prod_'+row_id+'\">';     
        field += '<input type=\"hidden\" name=\"product_id[]\" class=\"product_id\" value=\"'+row_id+'\" >';
        field += '<input type=\"hidden\" name=\"min_price[]\" class=\"min_price\" value=\"'+min_price+'\" >';
        field += '<input type=\"hidden\" name=\"srp[]\" class=\"srp\" value=\"'+srp+'\" >';
        field += '<input type=\"hidden\" name=\"product_amt[]\" class=\"product_amt\" value=\"'+srp+'\" >';
        field += '<td><input type="text" style=\"font-size: 10px !important;\" value="'+product_name+'" readonly="true" class="form-control item_name"></td>';
        field += '<td><input type="text" style=\"font-size: 10px !important;\" name="display_price[]" class="form-control display_price" readonly="true" value="'+srp+'"></td>';  
        field += '<td ><a href="javascript:void(0)" class="btn btn-xs default red remove_row"><i class="fa fa-times" aria-hidden="true"></i></a></td>'; 
        field += '</tr>';

        $('#cart_items').prepend(field);
        // if there is already a discount type applied
        if($('#string_trans_type').val() == 'per') {
            appendPerItemFields();
        }

        //count number of products in cart
        var rowCount = $('#cart_table tr').length-1;
        $('.cart_items_count').text(rowCount.toString());

        //compute raw amounts/values (no alterations or discounts)
        computeCartRaw();
}


function computeCartRaw() 
{
    //this function will only compute RAW totals, not discounts/altered prices here
    var sale_price = 0;
    var minimum_price = 0;

    // compute each item's original price
    $('.display_price').each(function(){
        sale_price = sale_price + parseFloat($(this).val());
    });

    // compute each item's minimum price
    $('.min_price').each(function(){
        minimum_price = minimum_price + parseFloat($(this).val());
    });

    // assign new values
    $('#float_cart_orig_price').val(sale_price);
    $('#float_cart_minimum_total').val(minimum_price);

    // display new raw/original cart total
    $('.initial_cart_price').text(addCommas(sale_price));
    $('.transaction_total').text(addCommas(sale_price));

    // compute taxes and vat
    computeVATRaw(sale_price);

}


function computeVATRaw(total)
{
    var tax_rate = parseFloat($('#float_tax_rate').val())/100;
    var tax_coverage = $('#string_tax_coverage').val();
    var vat_amt = 0;
    var amt_net_of_vat = 0;
    var incl_divisor = tax_rate + 1;
    console.log("incl_divisor: "+incl_divisor);

    if (tax_coverage == 'incl') {
        vat_amt = total*tax_rate;
        amt_net_of_vat = total - vat_amt;
        console.log("total: "+round(total,2));
        console.log("vat_amt: "+round(vat_amt,2));
        console.log("amt_net_of_vat: "+round(amt_net_of_vat,2));
        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#initial_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#initial_vat_amt").text(addCommas(round(vat_amt,2)));
    } else if (tax_coverage == 'excl') {
        vat_amt = total - (total/incl_divisor);
        amt_net_of_vat = total - vat_amt;
        console.log("total: "+round(total,2));
        console.log("vat_amt: "+round(vat_amt,2));
        console.log("amt_net_of_vat: "+round(amt_net_of_vat,2));
        $('#float_new_tax_vat_amt').val(round(vat_amt,2));
        $('#float_new_tax_amt_net_vat').val(round(amt_net_of_vat,2));
        $("#initial_amt_net_vat").text(addCommas(round(amt_net_of_vat,2)));
        $("#initial_vat_amt").text(addCommas(round(vat_amt,2)));
    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }


}



function round(value, exp) {
  if (typeof exp === 'undefined' || +exp === 0)
    return Math.round(value);

  value = +value;
  exp = +exp;

  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0))
    return NaN;

  // Shift
  value = value.toString().split('e');
  value = Math.round(+(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp)));

  // Shift back
  value = value.toString().split('e');
  return +(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp));
}






























function addDashes(nStr)
{
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + '-' + '$2');
    }
    return x1 + x2;
}



















// function computeCart()
// { 
//     var total = 0;
//     var new_total = 0;
//     var savings = 0;
    
//     // compute each item's original price
//     $('.display_price').each(function(){
//         total = total + parseFloat($(this).val());
//     });

//     // compute each item's adjusted price (if adjusted)
//     $('.adjusted_price').each(function(){
//         new_total = new_total + parseFloat($(this).val());
//     });

//     // set vars values
//     $('#float_cart_orig_price').val(total);
//     $('#float_cart_new_price').val(new_total);

//     // set visible price
//     $("#cart_orig_price").text(addCommas(total.toString()));
    


//     if ($('#string_trans_type').val() == 'indiv') {
//         $('#cart_int_price').val(new_total);
//         computeVAT(new_total, total);
//         if ($('#tax_coverage').val() == 'incl') {
//             $('#transaction_amt_to_pay').val(new_total);
//             $('#transaction_balance').val(new_total);
//             $(".cart_price").text(addCommas(new_total.toString()));
//             savings = total - new_total;
//         } else if ($('#tax_coverage').val() == 'excl') {
//             // var vat_amt = $('#cart_new_amt_vat').text();
//             // $('#transaction_amt_to_pay').val(vat_amt);
//             // $('#transaction_balance').val(vat_amt);
//             // $(".cart_price").text(addCommas($('float_cart_new_price').val()));
//             // savings = total - new_total;
//             var amt_to_pay = $('#float_new_excl_total').val();
//             $('#transaction_amt_to_pay').val(amt_to_pay);
//             $('#transaction_balance').val(amt_to_pay);
//             $(".cart_price").text(addCommas(amt_to_pay.toString()));
//             savings = amt_to_pay - new_total;
//         } else {

//         }
        
//         $('#customer_savings').text(addCommas(savings.toString()));
        
//     } else {
//         if($('#string_trans_type').val() != 'bulk') {
//             computeVAT(total, total);
//             $('#cart_int_price').val(total);
//             var new_amt = $('#cart_int_price').val();
//             if ($('#tax_coverage').val() == 'incl') {
//                 $('#transaction_amt_to_pay').val(new_amt);
//                 $('#transaction_balance').val(new_amt);
//                 $(".cart_price").text(addCommas(total.toString()));
//             } else if ($('#tax_coverage').val() == 'excl') {
//                 var amt_to_pay = $('#float_orig_excl_total').val();
//                 $('#transaction_amt_to_pay').val(amt_to_pay);
//                 $('#transaction_balance').val(amt_to_pay);
//                 $(".cart_price").text(addCommas(amt_to_pay.toString()));
//                 $("#cart_orig_price").text(addCommas(amt_to_pay.toString()));
//                 $('#float_cart_orig_price').val(amt_to_pay);
//             }
            
            
//         } else {
//             applyBulkAdjustment();
            
//         }
//     }
// }

function computeVAT(total, orig_total)
{
    var vat = parseFloat($('#session_vat').val())/100;
    var tax_coverage = $('#tax_coverage').val();

    if (tax_coverage == 'incl') {
        var vat_amt = (total * vat).toFixed(2);
        var amt_net_of_vat = (total - vat_amt).toFixed(2);;
        $("#cart_new_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));

        var vat_amt = (orig_total * vat).toFixed(2);
        var amt_net_of_vat = (orig_total-vat_amt).toFixed(2);;
        $("#cart_orig_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_orig_vat").text(addCommas(vat_amt.toString()));
    } else if (tax_coverage == 'excl') {
        var vat_amt = parseFloat(total * vat);
        var amt_net_of_vat = parseFloat(total);
        var xtotal = amt_net_of_vat + vat_amt;
        $("#cart_new_amt_vat").text(addCommas(total.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));
        $('#float_new_tax_vat_amt').val(vat_amt);
        $('#float_new_tax_amt_net_vat').val(total);
        $('#float_new_excl_total').val(xtotal);


        var vat_amt = parseFloat(orig_total * vat);
        var amt_net_of_vat = parseFloat(orig_total);
        var xtotal = amt_net_of_vat + vat_amt;
        $("#cart_orig_amt_vat").text(addCommas(orig_total.toString()));
        $("#cart_orig_vat").text(addCommas(vat_amt.toString()));
        $('#float_orig_tax_vat_amt').val(vat_amt);
        $('#float_orig_tax_amt_net_vat').val(orig_total);
        $('#float_orig_excl_total').val(xtotal);

    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }


}

function computeCartMinimum()
{
    var total = 0;
    $('.min_price').each(function(){
        total = total + parseFloat($(this).val());
    });

    $("#cart_min_price").val(total);

    if (total > $('#cart_int_price').val()) {
        //$('#cgroup-app_code').show();
        $('.cart_price_h3').css({'color': 'red'});
    } else {
        //$('#cgroup-app_code').hide();
        $('.cart_price_h3').css({'color': 'black'});
    }

    computeExtraAmount();
}






function computeExtraAmount()
{
    var cart_min_price = parseInt($("#cart_min_price").val());
    var cart_price = parseInt($("#cart_int_price").val());
    var extra_amt = cart_price - cart_min_price;
    var extra_amt_disp = addDashes(extra_amt.toString());
    $('#cart_min_pricex').text(addCommas(cart_min_price.toString()));
    $('#cart_pricex').text(addCommas(cart_price.toString()));
    $('#ea_amt').text(extra_amt_disp);
}






function appendPerItemColumns()
{
    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(1).after('<th>Discount Type</th>');
    });

    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(2).after('<th>Value</th>');
    });

    $('#cart_table').find('tr').each(function(){
        $(this).find('th').eq(3).after('<th>Adjusted Price</th>');
    });
    var ths = $('th');
    var element = ths.eq(0);
    element.width(250);
    var element2 = ths.eq(1);
    element2.width(110);
    var element2 = ths.eq(2);
    element2.width(110);
    var element2 = ths.eq(3);
    element2.width(110);
    var element2 = ths.eq(4);
    element2.width(110);
}




function hideBulkAmounts()
{
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    $('#cform-new_total').val('');
    $('#cgroup-new_total').hide();
}

function cancelBulkAdjustment()
{
    revertOriginalPrices();
    $('#cgroup-new_total').hide();
    $('#cform-new_total').val('');
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    $('.display_price').each(function() {
        if ($(this).val() == "0" || $(this).val() == 0.00) {
            //revert prices only if bulk discount came from gift
            var row = $(this).closest('tr');
            var srp = row.find('.srp').val();
            $(this).val(srp);
        }  
    });
}


function hideCartLastColumn()
{
    $('td:last-child').each(function(){
        if ($(this).closest('table').attr('id') == 'cart_table') {
            $(this).css("display", "none");    
        }
        
    });

    $('th:last-child').each(function(){
        if ($(this).closest('table').attr('id') == 'cart_table') {
            $(this).css("display", "none");
        }
    });
}

function showCartLastColumn()
{
    ('td:last-child').each(function(){
        if ($(this).closest('table').attr('id') == 'cart_table') {
            $(this).css("display", "");
        }
    });

    $('th:last-child').each(function(){
        if ($(this).closest('table').attr('id') == 'cart_table') {
            $(this).css("display", "");
        }
    });
}






function apply_indiv(x)
{
    var row = $(x).closest('tr');
    var srp = row.find('.srp').val();
    var adjusted_price = row.find('.adjusted_price');
    var per_item_discount_amt = row.find('.per_item_discount_amt');
    //adjusted_price.val(parseInt(srp)+100);

    if ($(x).val() == 'gift') {
        adjusted_price.val(0);
        per_item_discount_amt.attr("readonly", true); 
        per_item_discount_amt.val('');
    } else if ($(x).val() == 'disc') {
        adjusted_price.val(srp);
        per_item_discount_amt.val('');
        per_item_discount_amt.attr("readonly", false); 
    } else if ($(x).val() == 'chg') {
        adjusted_price.val(srp);
        per_item_discount_amt.val('');
        per_item_discount_amt.attr("readonly", false); 
    } else {
        adjusted_price.val(srp);
        per_item_discount_amt.attr("readonly", true); 
        per_item_discount_amt.val('');
    }

    computeCart();
    computeCartMinimum();
}


function proceedToTransaction(x)
{
    var select_trans = x;
    if (select_trans != '') {
        // $("#prods").addClass("disabledbutton");
        // $("#prod_cats").addClass("disabledbutton");
        if (select_trans == 'reg') {
            $('.next_step_btn').hide();
            $('.checkout_btn').show();
            $('#transaction_type_modal').modal('hide');
            // $('.remove_row').hide();
            // $('.clear_discount').show();
            $('.savings_h4').hide();
            $('.clear_discount').show();
            $('#reg_trans_flag').val(1);
            // hideCartLastColumn();
        } else if (select_trans == 'per') {
            // hideCartLastColumn();
            $('#reg_trans_flag').val(0);
            $('#string_trans_type').val('per');
            $('.next_step_btn').hide();
            $('.savings_h4').show();
            $('.checkout_btn').show();
            appendPerItemColumns();
            appendPerItemFields();
            $('#transaction_type_modal').modal('hide');
            $('.orig_totals_row').show();
            $('.orig_price_h3').show();
            $('.clear_discount').show();
        } else if (select_trans == 'bulk') {
            $('.next_step_btn').hide();
            $('#reg_trans_flag').val(0);
            // $('.remove_row').hide();
            $('.savings_h4').show();
            $('.bulk_adj').show();
            $('#proc').show();
            $('#transaction_type_modal').modal('hide');
            $('#bulk_adjustment').modal('show');
            $('.bulk_discount_h4').show();
            $('.checkout_btn').show();
            $('.orig_totals_row').show();
            $('.orig_price_h3').show();
            $('.clear_discount').show();
        } else {
            $('.clear_discount').hide();
            $('#reg_trans_flag').val(0);
        }
    } else {
        $('.clear_discount').hide();
        $('#reg_trans_flag').val(0);
    }
}



function revertDiscounts()
{
    $('#cart_table').find('tr').each(function(){
        if ($(this).children('th').length > 5) {
            $(this).find('th').eq(2).remove();
            $(this).find('th').eq(2).remove();
            $(this).find('th').eq(2).remove();
        }

        if ($(this).children('td').length > 5) {
            $(this).find('td').eq(2).remove();
            $(this).find('td').eq(2).remove();
            $(this).find('td').eq(2).remove();
        }
    });

    //alert($('#float_cart_orig_price').val());
    $('.cart_price_h3').css({'color': 'black'});
    $('#cgroup-new_total').hide();
    $('#cform-new_total').val('');
    $('#cform-discount_amount').val('');
    $('#cgroup-discount_amount').hide();
    $('#cform-discount_pct').val('');
    $('#cgroup-discount_pct').hide();
    $('.cart_price').text(addCommas($('#float_cart_orig_price').val()));
    $('#cart_int_price').val($('#float_cart_orig_price').val());
    computeCartMinimum();
    $('.orig_totals_row').hide();
    $('.orig_price_h3').hide();
    $('.bulk_discount_h4').hide();
    $('#applied_bulk_discount').val('');
    $('.checkout_btn').hide();
    $('.bulk_adj').hide();
    $('.next_step_btn').show();
    $('.clear_discount').hide();

    var vat = parseInt($('#session_vat').val())/100;
    var tax_coverage = $('#tax_coverage').val();
    var total = parseInt($('#float_cart_orig_price').val());
    var orig_total = parseInt($('#float_cart_orig_price').val());

    var new_amt = $('#float_cart_orig_price').val();
    if ($('#tax_coverage').val() == 'incl') {
        $('#transaction_amt_to_pay').val(new_amt);
        $('#transaction_balance').val(new_amt);
    } else if ($('#tax_coverage').val() == 'excl') {
        var vat_amt = $('#cart_new_amt_vat').text();
        $('#transaction_amt_to_pay').val(vat_amt);
        $('#transaction_balance').val(vat_amt);
    }


    if (tax_coverage == 'incl') {
        var vat_amt = (total * vat).toFixed(2);
        var amt_net_of_vat = (total-vat_amt).toFixed(2);
        $("#cart_new_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));
    } else if (tax_coverage == 'excl') {
        var vat_amt = parseInt(total * vat).toFixed(2);
        var amt_net_of_vat = (parseInt(total) + parseInt(vat_amt)).toFixed(2);
        $("#cart_new_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));
    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }
}



function applyBulkAdjustment()
{   
    var bulk_adj_opt = $('#bulk_opt_sel').val();
    if (bulk_adj_opt != '') {
        if (bulk_adj_opt == 'bgift') {
            $('.cart_price').text(0);
            $('#cart_int_price').val(0);
            $('#applied_bulk_discount').text('Gift');
            $('#customer_savings').text(addCommas($('#float_cart_orig_price').val()));

        } else if (bulk_adj_opt == 'bdiscamt') {
            var new_cart_total = $('#float_cart_orig_price').val() - $('#cform-discount_amount').val();
            if (new_cart_total >= 0) {
                $('.cart_price').text(addCommas(new_cart_total));
                $('#cart_int_price').val(new_cart_total);
                $('#applied_bulk_discount').text('Less Php '+$('#cform-discount_amount').val()+'');
                $('#customer_savings').text(addCommas($('#cform-discount_amount').val()));
            } else {
                toastr['error']('Invalid discount amount.', 'Error');
            }
        } else if (bulk_adj_opt == 'bdisc') {
            var new_cart_total = $('#float_cart_orig_price').val() - ($('#float_cart_orig_price').val() * ($('#cform-discount_pct').val()/100));
            var savings = $('#float_cart_orig_price').val() * ($('#cform-discount_pct').val()/100);
            if (new_cart_total >= 0) {
                $('.cart_price').text(addCommas(new_cart_total));
                $('#cart_int_price').val(new_cart_total);
                $('#applied_bulk_discount').text('Less '+$('#cform-discount_pct').val()+'% off');
                $('#customer_savings').text(addCommas(savings.toString()));
            } else {
                toastr['error']('Invalid discount.', 'Error');
            }
        } else if (bulk_adj_opt == 'bamt') {
            var savings = $('#cart_int_price').val() - $('#cform-new_total').val();
            $('#cart_int_price').val($('#cform-new_total').val());
            $('.cart_price').text(addCommas($('#cform-new_total').val()));
            $('#applied_bulk_discount').text('Change Amount');
            $('#customer_savings').text(addCommas(savings.toString()));
        } else {
            $('.display_price').each(function() {
                if ($(this).val() == "0" || $(this).val() == "0.00") {
                    //revert prices only if bulk discount came from gift
                    var row = $(this).closest('tr');
                    var srp = row.find('.srp').val();
                    $(this).val(srp);
                }
                
            });
            $('#applied_bulk_discount').text('');
            computeCart();
            computeCartMinimum();
        }
    } else {

    }

    var vat = parseInt($('#session_vat').val())/100;
    var tax_coverage = $('#tax_coverage').val();
    var total = parseInt($('#cart_int_price').val());
    var orig_total = parseInt($('#float_cart_orig_price').val());

    var new_amt = $('#cart_int_price').val();
    if ($('#tax_coverage').val() == 'incl') {
        $('#transaction_amt_to_pay').val(new_amt);
        $('#transaction_balance').val(new_amt);
    } else if ($('#tax_coverage').val() == 'excl') {
        var vat_amt = $('#cart_new_amt_vat').text();
        $('#transaction_amt_to_pay').val(vat_amt);
        $('#transaction_balance').val(vat_amt);
    }


    if (tax_coverage == 'incl') {
        var vat_amt = (total * vat).toFixed(2);
        var amt_net_of_vat = (total - vat_amt).toFixed(2);;
        $("#cart_new_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));

        var vat_amt = (orig_total * vat).toFixed(2);
        var amt_net_of_vat = (orig_total-vat_amt).toFixed(2);;
        $("#cart_orig_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_orig_vat").text(addCommas(vat_amt.toString()));
    } else if (tax_coverage == 'excl') {
        var vat_amt = parseInt(total * vat).toFixed(2);
        var amt_net_of_vat = (parseInt(total) + parseInt(vat_amt)).toFixed(2);
        $("#cart_new_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_new_vat").text(addCommas(vat_amt.toString()));

        var vat_amt = parseInt(orig_total * vat).toFixed(2);
        var amt_net_of_vat = (parseInt(orig_total) + parseInt(vat_amt)).toFixed(2);
        $("#cart_orig_amt_vat").text(addCommas(amt_net_of_vat.toString()));
        $("#cart_orig_vat").text(addCommas(vat_amt.toString()));
    } else {
        $("#cart_new_amt_vat").text("No vat set in ERP");
        $("#cart_new_vat").text("No vat set in ERP");
    }
}

function revertOriginalPrices()
{
    $('.display_price').each(function() {
        if ($(this).val() == "0" || $(this).val() == 0.00) {
            //revert prices only if bulk discount came from gift
            var row = $(this).closest('tr');
            var srp = row.find('.srp').val();
            $(this).val(srp);
        }
        
    });
    computeCart();
    computeCartMinimum();
}




// 
function updateBulkForm(opt)
{
    var bulk_adj_opt = opt;
    $('.indiv_adj').each(function() {
        $(this).hide();
    });

    if (bulk_adj_opt == 'bgift') {
        $('#bulk_opt_sel').val('bgift');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        $('#cform-discount_pct').val('');
        $('#cgroup-discount_pct').hide();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else if (bulk_adj_opt == 'bamt') {
        $('#bulk_opt_sel').val('bamt');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        $('#cform-discount_pct').val('');
        $('#cgroup-discount_pct').hide();
        // $('#cform-new_total').val('');
        $('#cgroup-new_total').show();
    } else if (bulk_adj_opt == 'bdiscamt') {
        // $('#cform-discount_amount').val('');
        $('#bulk_opt_sel').val('bdiscamt');
        $('#cgroup-discount_amount').show();
        $('#cform-discount_pct').val('');
        $('#cgroup-discount_pct').hide();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else if (bulk_adj_opt == 'bdisc') {
        $('#bulk_opt_sel').val('bdisc');
        $('#cform-discount_amount').val('');
        $('#cgroup-discount_amount').hide();
        // $('#cform-discount_pct').val('');
        $('#cgroup-discount_pct').show();
        $('#cform-new_total').val('');
        $('#cgroup-new_total').hide();
    } else {
        $('#bulk_opt_sel').val('na');
        cancelBulkAdjustment();
    }
}

// GIST POS
// August 8, 2017
function appendPerItemFields()
{
    if ($('#string_trans_type').val() == "per") {
        $('#cart_table').find('tr').each(function(){
            if ($(this).children('td').length < 6) {
                $(this).find('td').eq(1).after("<td style=\"font-size: 10px !important;\">\
                    {{ form.group_select_only3('Type', 'indiv_disc_opt', indiv_options, '', 12, 12, false)|e('js') }}</td>");
                $(this).find('td').eq(2).after("<td style=\"font-size: 10px !important;\">\
                    <input type=\"text\" style=\"font-size: 10px !important;\" class=\"form-control per_item_discount_amt\" readonly=\"true\" value=\"\"></td>");
                $(this).find('td').eq(3).after('<td><input type="text" style=\"font-size: 10px !important;\" class="form-control adjusted_price" readonly="true" value="0.00"></td>');

                var srp = $(this).find('.srp').val();
                var ap = $(this).find('.adjusted_price');
                ap.val(srp);
                //computeCart();
            }
        });
    }
}




$(document).ready(function(){   
    ajaxGetVAT();
    toastr.options = {
      "closeButton": false,
      "debug": false,
      "newestOnTop": false,
      "progressBar": true,
      "positionClass": "toast-bottom-right",
      "preventDuplicates": true,
      "onclick": null,
      "showDuration": "300",
      "hideDuration": "1000",
      "timeOut": "5000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    }

    // CLEAN

    $(document).on("click",".remove_row", function(e){
        e.preventDefault();            
        var tr = $(this).closest('tr');
        tr.remove();
        if($('#string_trans_type') != 'none') {

        } else {
            computeCartRaw();
        }
        return false;
    });
    // END CLEAN

    $(document).on('keyup', '.per_item_discount_amt', function () {
        $(this).val(this.value.match(/[0-9]*/));
        var row = $(this).closest('tr');
        var srp = row.find('.srp').val();
        var adjusted_price = row.find('.adjusted_price');
        var per_item_discount_amt = row.find('.per_item_discount_amt');
        var pos_indiv_discount_opt = row.find('.pos_indiv_discount_opt').val();

        if (pos_indiv_discount_opt == 'disc') {
            if (parseFloat($(this).val()) > 100) {
                toastr['error']('Discount percentage exceeded.', 'Error');
                $(this).val(100);
            }
            var discounted_price = srp - (srp * ($(this).val()/100));
            adjusted_price.val(discounted_price);
        } else if (pos_indiv_discount_opt == 'chg') {
            adjusted_price.val($(this).val());
        }
        
        computeCart();
        computeCartMinimum();

    });

    $(document).on('keyup', '#cform-cash_received_amt', function () {
        $(this).val(this.value.match(/[0-9]*/));
        if ($(this).val() != '') {
            var amt_to_pay = $('#transaction_amt_to_pay').val();
            var chg_amt = parseInt($(this).val()) - parseInt(amt_to_pay);
            alert(chg_amt);
            if (chg_amt >= 0) {
                var change = chg_amt;  
                $('#cform-cash_chg_amt').val(addCommas(change));  
            } else {
                var change = 0;
                $('#cform-cash_chg_amt').val(change);
            }
            
        } else {
            $('#cform-cash_chg_amt').val("0");
        }
        

    });


    //$('#cgroup-app_code').hide();
    $('.bulk_adj').hide();
    $('.clear_discount').hide();
    $('.checkout_btn').hide();
    $('.orig_totals_row').hide();
    $('.orig_price_h3').hide();
    $('.bulk_discount_h4').hide();
    $('.savings_h4').hide();
    ajaxGetProductCategories();

    $('#cform-new_price').val('');
    $('#cgroup-new_price').hide();
    hideBulkAmounts();

    //Select Trans Type
    $(document).on("click",".next_step_btn", function(e){
        if ($('#cart_table tr').length > 1) {
            $('#transaction_type_modal').modal('show');
        } else {
            toastr['warning']('Add products to cart before proceeding to next step.', 'Warning');
        }
    });

    $(document).on("click",".checkout_btn", function(e){
        // computeCart();
        if ($('#cart_table tr').length > 1) {
            $('#checkout_modal').modal('show');
            if (parseFloat($('#transaction_balance').val()) == 0) {
                $('.co_amt_to_pay').text(addCommas($('#transaction_amt_to_pay').val().toString()));
                $('.co_balance').text(addCommas($('#transaction_amt_to_pay').val().toString()));
            } else {
                $('.co_amt_to_pay').text(addCommas($('#transaction_amt_to_pay').val().toString()));
                $('.co_balance').text(addCommas($('#transaction_amt_to_pay').val().toString()));
            }
        } else {
            toastr['warning']('Add products to cart before proceeding to next step.', 'Warning');
        }
        
    });

    $(document).on("click",".co_cash_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#cash_modal').modal('show');
    });

    $(document).on("click",".co_cc_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#cc_modal').modal('show');
    });

    $(document).on("click",".co_check_payment", function(e){
        $('#checkout_modal').modal('hide');
        $('#check_modal').modal('show');
    });

    
    $(document).on("click",".cash_go_back", function(e){
        $('#cash_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    $(document).on("click",".cc_go_back", function(e){
        $('#cc_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    $(document).on("click",".check_go_back", function(e){
        $('#check_modal').modal('hide');
        $('#checkout_modal').modal('show');
    });

    //Proceed
    $(document).on("click",".proceed_btn", function(e){
        proceedToTransaction();
    });



    $(document).on("click",".apply_bulk", function(e){
        applyBulkAdjustment();
    });

    $(document).on("click",".numeric_key", function(e){
        //alert($(this).data("value"));
        if ($(this).data("value") == 'CLEAR') {
            $('#cform-cash_received_amt').val("");
            $('#cform-cash_chg_amt').val(0);
        } else if ($(this).data("value") == 'DEL') {
            var str = $('#cform-cash_received_amt').val();
            $('#cform-cash_received_amt').val(str.substring(0, str.length - 1));
            var amt_to_pay = $('#transaction_amt_to_pay').val();
            // var change = parseFloat($('#cform-cash_received_amt').val()) - amt_to_pay;
            var chg_amt = parseInt($('#cform-cash_received_amt').val()) - amt_to_pay;
            //var chg_amt = parseFloat($(this).val()) - parseFloat(amt_to_pay);
            if (chg_amt >= 0) {
                var change = chg_amt;  
                $('#cform-cash_chg_amt').val(addCommas(change));  
            } else {
                var change = 0;
                $('#cform-cash_chg_amt').val(change);
            }
            $('#cform-cash_chg_amt').val(addCommas(change));
        } else {
            $('#cform-cash_received_amt')[0].value += $(this).data("value");
            var amt_to_pay = $('#transaction_amt_to_pay').val();
            var chg_amt = parseInt($('#cform-cash_received_amt').val()) - amt_to_pay;
            //var chg_amt = parseFloat($(this).val()) - parseFloat(amt_to_pay);
            if (chg_amt >= 0) {
                var change = chg_amt;  
                $('#cform-cash_chg_amt').val(addCommas(change));  
            } else {
                var change = 0;
                $('#cform-cash_chg_amt').val(change);
            }
        }
    });

    $(document).on("click",".clear_discount", function(e){
        revertDiscounts();
        $('.savings_h4').hide();
    });

    $(window).keydown(function(event){
        if(event.keyCode == 13) {
          event.preventDefault();
          return false;
        }
    });

    $(document).on("click",".category_btn", function(e){

        $('.category_btn').each(function() {
            $(this).css({'background-color': '#556E93'});
        });
        $('#selected_pcat').text(' - '+$(this).html());
        $(this).css({'background-color': '#484c50'});
    });

    $('#cform-indiv_adj').on("change", function()
    {
        var indiv_adj_opt = $('#cform-indiv_adj').val();
        if (indiv_adj_opt == 'chg') {
            $('#cform-new_price').val('');
            $('#cgroup-new_price').show();
        } else {
            $('#cgroup-new_price').hide();
            $('#cform-new_price').val('');
        }
    });

    $('#cform-bulk_adj').on("change", function()
    {
        
    });


    $('#bulk_adjustment').on('shown.bs.modal', function () {

    });

    $('#bulk_adjustment').on('hidden.bs.modal', function () {
        computeCartMinimum();

    });

    $(document).on("click",".remove_row", function(e){
        e.preventDefault();            
        var tr = $(this).closest('tr');
        tr.remove();
        if($('#string_trans_type') != 'none') {

        } else {
            computeCartRaw();
        }
        return false;
    });


    $(document).on("click",".bulk_adj", function(e){
        $('#bulk_adjustment').modal('show');
    });


    $("#cform-discount_pct").keyup(function() {
        $("#cform-discount_pct").val(this.value.match(/[0-9]*/));
    });

    $("#cform-discount_amount").keyup(function() {
        $("#cform-discount_amount").val(this.value.match(/[0-9]*/));
    });

    $("#cform-new_price").keyup(function() {
        $("#cform-new_price").val(this.value.match(/[0-9]*/));
    });
});
</script>
{% endblock %}